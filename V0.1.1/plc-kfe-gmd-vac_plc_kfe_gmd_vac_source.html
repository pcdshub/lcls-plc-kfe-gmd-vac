

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>DUTs &mdash; pcdshub/lcls-plc-kfe-gmd-vac  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/doctr-versions-menu.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Settings" href="plc-kfe-gmd-vac_plc_kfe_gmd_vac_sim_summary.html" />
    <link rel="prev" title="Data Types" href="plc-kfe-gmd-vac_plc_kfe_gmd_vac_epics.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> pcdshub/lcls-plc-kfe-gmd-vac
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">plc-kfe-gmd-vac</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gmd-vac_pragmas.html">Pragmas</a></li>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gmd-vac_nc.html">NC Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gmd-vac_boxes.html">Boxes</a></li>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gmd-vac_links.html">Links</a></li>
</ul>
<p class="caption"><span class="caption-text">plc_kfe_gmd_vac</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gmd-vac_plc_kfe_gmd_vac_summary.html">Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gmd-vac_plc_kfe_gmd_vac_summary.html#pragmas">Pragmas</a></li>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gmd-vac_plc_kfe_gmd_vac_summary.html#libraries">Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gmd-vac_plc_kfe_gmd_vac_summary.html#symbols">Symbols</a></li>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gmd-vac_plc_kfe_gmd_vac_epics.html">Data Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gmd-vac_plc_kfe_gmd_vac_epics.html#database-records">Database Records</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">DUTs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#e-gastype">E_GasType</a></li>
<li class="toctree-l2"><a class="reference internal" href="#e-homestate">E_HomeState</a></li>
<li class="toctree-l2"><a class="reference internal" href="#e-movestate">E_MoveState</a></li>
<li class="toctree-l2"><a class="reference internal" href="#st-hv">ST_HV</a></li>
<li class="toctree-l2"><a class="reference internal" href="#st-pressuresensor">ST_PressureSensor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#st-vgp">ST_VGP</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#gvls">GVLs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#gvl-gmd">GVL_GMD</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-inj">GVL_INJ</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-vac-intf">GVL_VAC_INTF</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-variables">GVL_VARIABLES</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#pous">POUs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#f-hv-ilk">F_HV_ILK</a></li>
<li class="toctree-l2"><a class="reference internal" href="#f-turbo-prot-slnd-ilk">F_TURBO_PROT_SLND_ILK</a></li>
<li class="toctree-l2"><a class="reference internal" href="#f-turbogatevalve-protection-ilk-local">F_TurboGateValve_Protection_ILK_local</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-highvoltage">FB_HighVoltage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-pressuretransducer">FB_PressureTransducer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-rtd">FB_RTD</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-vgp">FB_VGP</a></li>
<li class="toctree-l2"><a class="reference internal" href="#main">MAIN</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-diagnostic">PRG_DIAGNOSTIC</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-gas-selection">PRG_Gas_Selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-gmd">PRG_GMD</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-hv-ilk">PRG_HV_ILK</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-inj">PRG_INJ</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-pressurecontrol">PRG_PressureControl</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-purge">PRG_Purge</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-vac-intf">PRG_VAC_INTF</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-vgp">PRG_VGP</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">plc_kfe_gmd_vac_sim</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gmd-vac_plc_kfe_gmd_vac_sim_summary.html">Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gmd-vac_plc_kfe_gmd_vac_sim_summary.html#pragmas">Pragmas</a></li>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gmd-vac_plc_kfe_gmd_vac_sim_summary.html#libraries">Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gmd-vac_plc_kfe_gmd_vac_sim_summary.html#symbols">Symbols</a></li>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gmd-vac_plc_kfe_gmd_vac_sim_epics.html">Data Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gmd-vac_plc_kfe_gmd_vac_sim_epics.html#database-records">Database Records</a></li>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gmd-vac_plc_kfe_gmd_vac_sim_source.html">DUTs</a></li>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gmd-vac_plc_kfe_gmd_vac_sim_source.html#gvls">GVLs</a></li>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gmd-vac_plc_kfe_gmd_vac_sim_source.html#pous">POUs</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pcdshub/lcls-plc-kfe-gmd-vac</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>DUTs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/plc-kfe-gmd-vac_plc_kfe_gmd_vac_source.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="duts">
<h1>DUTs<a class="headerlink" href="#duts" title="Permalink to this headline">¶</a></h1>
<div class="section" id="e-gastype">
<h2>E_GasType<a class="headerlink" href="#e-gastype" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">E_GasType</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">none</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">Neon</span><span class="p">,</span>
    <span class="n">Argon</span><span class="p">,</span>
    <span class="n">Krypton</span><span class="p">,</span>
    <span class="n">Xenon</span>
<span class="p">);</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</div>
<div class="section" id="e-homestate">
<h2>E_HomeState<a class="headerlink" href="#e-homestate" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">E_HomeState</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">H_READY</span><span class="p">,</span>
    <span class="n">H_INIT</span><span class="p">,</span>
    <span class="n">H_RESET_LL</span><span class="p">,</span>
    <span class="n">H_RESET_HL</span><span class="p">,</span>
    <span class="n">H_ENABLE</span><span class="p">,</span>
    <span class="n">H_MOVING</span><span class="p">,</span>
    <span class="n">H_MOVING2</span><span class="p">,</span>
    <span class="n">H_CHECK</span><span class="p">,</span>
    <span class="n">H_RESET</span><span class="p">,</span>
    <span class="n">H_SET_POS</span><span class="p">,</span>
    <span class="n">H_ERROR</span><span class="p">,</span>
    <span class="n">H_WRITE_LL</span><span class="p">,</span>
    <span class="n">H_WRITE_HL</span><span class="p">,</span>
    <span class="n">H_DONE</span>

<span class="p">)</span> <span class="n">UDINT</span><span class="p">;</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</div>
<div class="section" id="e-movestate">
<h2>E_MoveState<a class="headerlink" href="#e-movestate" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">E_MoveState</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">ABORT</span><span class="p">,</span>
    <span class="n">INIT</span><span class="p">,</span>
    <span class="n">ENABLE</span><span class="p">,</span>
    <span class="n">FORWARD</span><span class="p">,</span>
    <span class="n">BACKWARDS</span><span class="p">,</span>
    <span class="n">READY</span><span class="p">,</span>
    <span class="n">MOVING</span><span class="p">,</span>
    <span class="n">NEWTARGETPOSITION</span><span class="p">,</span>
    <span class="n">NEWTARGETPOSITION2</span><span class="p">,</span>
    <span class="n">ERROR</span><span class="p">,</span>
    <span class="n">RESET</span><span class="p">,</span>
    <span class="n">HALT</span><span class="p">,</span>
    <span class="n">HOME</span>
<span class="p">)</span> <span class="n">UDINT</span><span class="p">;</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</div>
<div class="section" id="st-hv">
<h2>ST_HV<a class="headerlink" href="#st-hv" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">ST_HV</span> <span class="p">:</span>
<span class="n">STRUCT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">HV_SW</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">HV_sw</span><span class="p">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="kc">True</span><span class="p">;</span> <span class="o">//</span> <span class="n">EPICS</span> <span class="n">control</span> <span class="k">for</span> <span class="n">switching</span> <span class="n">the</span> <span class="n">HV</span> <span class="n">on</span> <span class="ow">or</span> <span class="n">off</span><span class="o">.</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">HV_DO</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">q_HV_DO</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span> <span class="o">//</span> <span class="n">Readout</span> <span class="n">of</span> <span class="n">the</span> <span class="n">HV</span><span class="s1">&#39;s ouput value</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ILK_OK</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">xIlkOK</span>  <span class="p">:</span>       <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Interlock</span> <span class="n">Bit</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PRO_SP</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rPRO_SP</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mf">0.0001</span><span class="p">;</span> <span class="o">//</span> <span class="n">Pressure</span> <span class="n">below</span> <span class="n">which</span> <span class="n">the</span> <span class="n">HV</span> <span class="n">signal</span> <span class="n">may</span> <span class="n">turn</span> <span class="n">o</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</div>
<div class="section" id="st-pressuresensor">
<h2>ST_PressureSensor<a class="headerlink" href="#st-pressuresensor" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">ST_PressureSensor</span> <span class="p">:</span>
<span class="n">STRUCT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PRESS</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rPRESS</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span> <span class="o">//</span><span class="n">This</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">human</span><span class="o">-</span><span class="n">readable</span> <span class="n">pressure</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">iPRESS</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">iPRESS_R</span> <span class="p">:</span> <span class="n">INT</span> <span class="p">;</span> <span class="o">//</span><span class="nb">input</span> <span class="n">pressure</span> <span class="ow">in</span> <span class="n">machine</span> <span class="n">form</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PRESS_SP</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rPressSP</span><span class="p">:</span> <span class="n">REAL</span> <span class="p">;</span> <span class="o">//</span> <span class="n">EPICS</span> <span class="n">Pressure</span> <span class="n">setpoint</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">MIN_SP</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rMinPressSP</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>  <span class="o">//</span> <span class="n">Low</span> <span class="n">limit</span> <span class="n">of</span> <span class="n">pressure</span> <span class="n">setpoint</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">MAX_SP</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rMaxPressSP</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>     <span class="o">//</span> <span class="n">High</span> <span class="n">limit</span> <span class="n">of</span> <span class="n">pressure</span> <span class="n">setpoint</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">SCALE</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rFULL_SCALE</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span> <span class="o">//</span> <span class="n">Full</span> <span class="n">scale</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ALARM</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">Normal</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">Alarm</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">xPstateAlarm</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span> <span class="o">//</span> <span class="mi">0</span><span class="p">:</span><span class="n">Normal</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">Alarm</span>


<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</div>
<div class="section" id="st-vgp">
<h2>ST_VGP<a class="headerlink" href="#st-vgp" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">ST_VGP</span> <span class="p">:</span>
<span class="n">STRUCT</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">POS_RBV</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="o">//</span> <span class="n">Inputs</span>
    <span class="n">i_iPosition</span>     <span class="p">:</span>       <span class="n">REAL</span><span class="p">;</span> <span class="o">//</span><span class="n">Encoder</span> <span class="n">position</span> <span class="n">readback</span> <span class="p">(</span><span class="k">if</span> <span class="n">it</span> <span class="n">exists</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ENC_RBV</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="o">//</span> <span class="n">Inputs</span>
    <span class="n">rEnoder_Position</span>        <span class="p">:</span>       <span class="n">REAL</span><span class="p">;</span> <span class="o">//</span><span class="n">Encoder</span> <span class="n">position</span> <span class="n">readback</span> <span class="p">(</span><span class="k">if</span> <span class="n">it</span> <span class="n">exists</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ERROR</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">FALSE</span><span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="o">//</span> <span class="n">Inputs</span>
    <span class="n">pv_xError</span>       <span class="p">:</span>       <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">IS_HOMED</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">FALSE</span><span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="o">//</span> <span class="n">Inputs</span>
    <span class="n">pv_xHomed</span>       <span class="p">:</span>       <span class="n">BOOL</span> <span class="o">:=</span><span class="n">false</span><span class="p">;</span>


    <span class="o">//</span><span class="n">Softvariables</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ILK_OK</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">FALSE</span><span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">xIlkOK</span>  <span class="p">:</span>       <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Interlock</span> <span class="n">Bit</span>
    <span class="o">//</span><span class="n">Manually</span> <span class="n">Pressing</span> <span class="n">valve</span> <span class="s2">&quot;Open/Close&quot;</span> <span class="n">on</span> <span class="n">EDM</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">OPN_SW</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">FALSE</span><span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">pv_xOPN_SW</span>      <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">GO_SW</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">pv_xGo_SW</span>       <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">HOME_SW</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">FALSE</span><span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">pv_xHome_SW</span>     <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">Reset_SW</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">FALSE</span><span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">pv_xReset_SW</span>    <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">Busy</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">FALSE</span><span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">xBusy</span>   <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ABORT</span><span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">FALSE</span><span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">pv_xABORT_SW</span>    <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>


    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">POS_CTRL</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqPosition</span>    <span class="p">:</span>       <span class="n">REAL</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Outputs</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">POS_DES</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">q_iRawPosition</span>  <span class="p">:</span>       <span class="n">INT</span><span class="p">;</span> <span class="o">//</span><span class="n">Position</span> <span class="n">control</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">STATE</span><span class="p">;</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">mbbi</span> <span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZRST</span> <span class="n">CLOSE</span> <span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONST</span> <span class="n">OPEN</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">TWST</span> <span class="n">PRESS</span> <span class="n">CNTRL</span> <span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">THST</span> <span class="n">MANUAL</span> <span class="n">CNTRL</span> <span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">eValveControl</span>   <span class="p">:</span>       <span class="n">E_VCN</span> <span class="o">:=</span> <span class="n">CloseValve</span><span class="p">;</span> <span class="o">//</span> <span class="n">Valve</span> <span class="n">control</span> <span class="n">state</span>
    <span class="o">///</span> <span class="n">state</span> <span class="n">machine</span> <span class="n">state</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">Axis_STATE</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">eState</span><span class="p">:</span> <span class="n">E_MoveState</span><span class="p">;</span> <span class="o">//</span><span class="n">Axis</span> <span class="n">Move</span> <span class="n">state</span>
    <span class="n">ftIlk</span>   <span class="p">:</span>       <span class="n">F_TRIG</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ERR_ID</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">nErrorID</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ERR_MSG</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">sErrorMessage</span> <span class="p">:</span> <span class="n">STRING</span><span class="p">;</span>

<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="gvls">
<h1>GVLs<a class="headerlink" href="#gvls" title="Permalink to this headline">¶</a></h1>
<div class="section" id="gvl-gmd">
<h2>GVL_GMD<a class="headerlink" href="#gvl-gmd" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VAR_GLOBAL</span>

<span class="o">//</span> <span class="n">To</span> <span class="n">Remove</span><span class="p">:</span>
<span class="o">//</span> <span class="n">Includes</span> <span class="s1">&#39;fake&#39;</span> <span class="n">elements</span> <span class="k">for</span> <span class="n">satisfying</span> <span class="n">interlocks</span><span class="o">.</span> <span class="n">Delete</span> <span class="n">these</span> <span class="n">after</span> <span class="n">creating</span> <span class="n">better</span> <span class="n">interlock</span> <span class="n">functions</span>

<span class="o">//</span> <span class="n">Defaults</span> <span class="n">to</span> <span class="n">the</span> <span class="n">closed</span> <span class="n">position</span><span class="o">.</span> <span class="n">No</span> <span class="n">command</span> <span class="n">required</span><span class="o">.</span>
<span class="n">fake_always_closed_vent_valve</span> <span class="p">:</span> <span class="n">ST_VVC</span><span class="p">;</span>

<span class="o">//</span> <span class="n">FB_MKS317</span>

<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: EM1K0:GMD:GPI:10 &#39;</span><span class="p">}</span>
<span class="n">fb_EM1K0_GMD_GPI_10</span> <span class="p">:</span> <span class="n">FB_MKS317</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: EM1K0:GMD:GPI:40 &#39;</span><span class="p">}</span>
<span class="n">fb_EM1K0_GMD_GPI_40</span> <span class="p">:</span> <span class="n">FB_MKS317</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: EM1K0:GMD:GPI:70 &#39;</span><span class="p">}</span>
<span class="n">fb_EM1K0_GMD_GPI_70</span> <span class="p">:</span> <span class="n">FB_MKS317</span><span class="p">;</span>

<span class="o">//</span> <span class="n">FB_PTM_TwisTorr</span>

<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: EM1K0:GMD:PTM:10 &#39;</span><span class="p">}</span>
<span class="n">fb_EM1K0_GMD_PTM_10</span> <span class="p">:</span> <span class="n">FB_PTM_TwisTorr</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: EM1K0:GMD:PTM:20 &#39;</span><span class="p">}</span>
<span class="n">fb_EM1K0_GMD_PTM_20</span> <span class="p">:</span> <span class="n">FB_PTM_TwisTorr</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: EM1K0:GMD:PTM:30 &#39;</span><span class="p">}</span>
<span class="n">fb_EM1K0_GMD_PTM_30</span> <span class="p">:</span> <span class="n">FB_PTM_TwisTorr</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: EM1K0:GMD:PTM:40 &#39;</span><span class="p">}</span>
<span class="n">fb_EM1K0_GMD_PTM_40</span> <span class="p">:</span> <span class="n">FB_PTM_TwisTorr</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: EM1K0:GMD:PTM:50 &#39;</span><span class="p">}</span>
<span class="n">fb_EM1K0_GMD_PTM_50</span> <span class="p">:</span> <span class="n">FB_PTM_TwisTorr</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: EM1K0:GMD:PTM:60 &#39;</span><span class="p">}</span>
<span class="n">fb_EM1K0_GMD_PTM_60</span> <span class="p">:</span> <span class="n">FB_PTM_TwisTorr</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: EM1K0:GMD:PTM:70 &#39;</span><span class="p">}</span>
<span class="n">fb_EM1K0_GMD_PTM_70</span> <span class="p">:</span> <span class="n">FB_PTM_TwisTorr</span><span class="p">;</span>

<span class="o">//</span> <span class="n">FB_VRC</span>

<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: EM1K0:GMD:VRC:10 &#39;</span><span class="p">}</span>
<span class="n">fb_EM1K0_GMD_VRC_10</span> <span class="p">:</span> <span class="n">FB_VRC</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: EM1K0:GMD:VRC:20 &#39;</span><span class="p">}</span>
<span class="n">fb_EM1K0_GMD_VRC_20</span> <span class="p">:</span> <span class="n">FB_VRC</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: EM1K0:GMD:VRC:30 &#39;</span><span class="p">}</span>
<span class="n">fb_EM1K0_GMD_VRC_30</span> <span class="p">:</span> <span class="n">FB_VRC</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: EM1K0:GMD:VRC:50 &#39;</span><span class="p">}</span>
<span class="n">fb_EM1K0_GMD_VRC_50</span> <span class="p">:</span> <span class="n">FB_VRC</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: EM1K0:GMD:VRC:60 &#39;</span><span class="p">}</span>
<span class="n">fb_EM1K0_GMD_VRC_60</span> <span class="p">:</span> <span class="n">FB_VRC</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: EM1K0:GMD:VRC:70 &#39;</span><span class="p">}</span>
<span class="n">fb_EM1K0_GMD_VRC_70</span> <span class="p">:</span> <span class="n">FB_VRC</span><span class="p">;</span>

<span class="o">//</span> <span class="n">FB_MKS422</span>

<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: EM1K0:GMD:GCC:10 &#39;</span><span class="p">}</span>
<span class="n">fb_EM1K0_GMD_GCC_10</span> <span class="p">:</span> <span class="n">FB_MKS422</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: EM1K0:GMD:GCC:20 &#39;</span><span class="p">}</span>
<span class="n">fb_EM1K0_GMD_GCC_20</span> <span class="p">:</span> <span class="n">FB_MKS422</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: EM1K0:GMD:GCC:30 &#39;</span><span class="p">}</span>
<span class="n">fb_EM1K0_GMD_GCC_30</span> <span class="p">:</span> <span class="n">FB_MKS422</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: EM1K0:GMD:GCC:40 &#39;</span><span class="p">}</span>
<span class="n">fb_EM1K0_GMD_GCC_40</span> <span class="p">:</span> <span class="n">FB_MKS422</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: EM1K0:GMD:GCC:50 &#39;</span><span class="p">}</span>
<span class="n">fb_EM1K0_GMD_GCC_50</span> <span class="p">:</span> <span class="n">FB_MKS422</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: EM1K0:GMD:GCC:60 &#39;</span><span class="p">}</span>
<span class="n">fb_EM1K0_GMD_GCC_60</span> <span class="p">:</span> <span class="n">FB_MKS422</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: EM1K0:GMD:GCC:70 &#39;</span><span class="p">}</span>
<span class="n">fb_EM1K0_GMD_GCC_70</span> <span class="p">:</span> <span class="n">FB_MKS422</span><span class="p">;</span>

<span class="o">//</span> <span class="n">FB_EbaraEVA</span>

<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: EM1K0:GMD:PRT:40 &#39;</span><span class="p">}</span>
<span class="n">fb_EM1K0_GMD_PRT_40</span> <span class="p">:</span> <span class="n">FB_EbaraEVA</span><span class="p">;</span>

<span class="o">//</span> <span class="n">FB_VVC</span>

<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: EM1K0:GMD:VVC:40 &#39;</span><span class="p">}</span>
<span class="n">fb_EM1K0_GMD_VVC_40</span> <span class="p">:</span> <span class="n">FB_VVC</span><span class="p">;</span>

<span class="o">//</span><span class="n">Roughing</span> <span class="n">DC</span> <span class="n">Valves</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv:  EM1K0:GMD:VRO:40 &#39;</span><span class="p">}</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span>    <span class="s1">&#39;.q_xOPN_DO     :=      TIIB[EL2212_03_09]^DOX Control Channel 2^Control^Output&#39;</span><span class="p">}</span>
<span class="n">fb_EM1K0_GMD_VRO_40</span> <span class="p">:</span> <span class="n">FB_VVC</span><span class="p">;</span>

<span class="n">END_VAR</span>
</pre></div>
</div>
</div>
<div class="section" id="gvl-inj">
<h2>GVL_INJ<a class="headerlink" href="#gvl-inj" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VAR_GLOBAL</span>

<span class="o">//</span><span class="n">GVL_Devices</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:VCN:40 &#39;</span><span class="p">}</span>
    <span class="n">VCN_40</span> <span class="p">:</span> <span class="n">FB_VCN</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:VGP:40 &#39;</span><span class="p">}</span>
    <span class="n">VGP_40</span> <span class="p">:</span> <span class="n">FB_VGP</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:VVC:80 &#39;</span><span class="p">}</span>
    <span class="n">VVC_80</span><span class="p">:</span><span class="n">FB_VVC</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:VVC:81 &#39;</span><span class="p">}</span>
    <span class="n">VVC_81</span><span class="p">:</span><span class="n">FB_VVC</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:VVC:82 &#39;</span><span class="p">}</span>
    <span class="n">VVC_82</span><span class="p">:</span><span class="n">FB_VVC</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:VVC:83 &#39;</span><span class="p">}</span>
    <span class="n">VVC_83</span> <span class="p">:</span> <span class="n">FB_VVC</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:VVC:84 &#39;</span><span class="p">}</span>
    <span class="n">VVC_84</span> <span class="p">:</span> <span class="n">FB_VVC</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:VVC:85 &#39;</span><span class="p">}</span>
    <span class="n">VVC_85</span> <span class="p">:</span> <span class="n">FB_VVC</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:VVC:86 &#39;</span><span class="p">}</span>
    <span class="n">VVC_86</span> <span class="p">:</span> <span class="n">FB_VVC</span><span class="p">;</span>


    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:GCM:80 &#39;</span><span class="p">}</span>
    <span class="n">GCM_80</span><span class="p">:</span> <span class="n">FB_GCM</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:INJ_Override &#39;</span><span class="p">}</span>
    <span class="n">xOverrideMode</span> <span class="p">:</span> <span class="n">BOOL</span><span class="o">:=</span> <span class="n">false</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Additional</span> <span class="n">VCN</span> <span class="n">Interlock</span><span class="o">*</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv:  EM1K0:GMD:VCN_ILK;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">FALSE</span><span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">TRUE</span><span class="p">;</span>
     <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
     <span class="s1">&#39;}</span>
    <span class="n">bAdditionalVCNIlk</span> <span class="p">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>

<span class="o">//</span><span class="n">GVL_Sensors</span>

<span class="p">(</span><span class="o">*</span><span class="n">Pressure</span> <span class="n">Meter</span><span class="o">*</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:GFM:86 &#39;</span><span class="p">}</span>
    <span class="n">GFM_86</span> <span class="p">:</span><span class="n">FB_PressureTransducer</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:GFM:85 &#39;</span><span class="p">}</span>
    <span class="n">GFM_85</span> <span class="p">:</span><span class="n">FB_PressureTransducer</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:GFM:84 &#39;</span><span class="p">}</span>
    <span class="n">GFM_84</span> <span class="p">:</span><span class="n">FB_PressureTransducer</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:GFM:83 &#39;</span><span class="p">}</span>
    <span class="n">GFM_83</span> <span class="p">:</span><span class="n">FB_PressureTransducer</span><span class="p">;</span>

<span class="p">(</span><span class="o">*</span><span class="n">HV</span><span class="o">*</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:PSV:1 &#39;</span><span class="p">}</span>
    <span class="n">hv1</span> <span class="p">:</span> <span class="n">FB_HighVoltage</span><span class="p">;</span>
    <span class="o">//</span> <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:HV:2 &#39;</span><span class="p">}</span>
    <span class="o">//</span> <span class="n">hv2</span> <span class="p">:</span> <span class="n">FB_HighVoltage</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:RTD:1 &#39;</span><span class="p">}</span>
    <span class="n">RTD</span> <span class="p">:</span> <span class="n">FB_RTD</span><span class="p">;</span>


<span class="p">(</span><span class="o">*</span> <span class="n">Pressure</span> <span class="n">Control</span><span class="o">*</span><span class="p">)</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: EM1K0:GMD:GCP:40 &#39;</span><span class="p">}</span>
    <span class="n">GCP</span><span class="p">:</span> <span class="n">ST_VG</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:CNTRL:SP;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">HOPR</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">LOPR</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">PREC</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">EGU</span> <span class="s2">&quot;TORR&quot;</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">fSetpointValue</span> <span class="p">:</span><span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:CNTRL:GO;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">STOP</span><span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">START</span><span class="p">;</span>
     <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">bGo</span><span class="p">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:CNTRL:RESET;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">FALSE</span><span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">TRUE</span><span class="p">;</span>
     <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
     <span class="s1">&#39;}</span>
    <span class="n">bReset</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:CNTRL:ERROR;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">FALSE</span><span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">TRUE</span><span class="p">;</span>
     <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
     <span class="s1">&#39;}</span>
    <span class="n">bError</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:CNTRL:Kp1 &#39;</span><span class="p">}</span>
    <span class="n">fKp1</span> <span class="p">:</span> <span class="n">REAL</span><span class="o">:=</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:CNTRL:Tn1 &#39;</span><span class="p">}</span>
    <span class="n">fTn1</span> <span class="p">:</span> <span class="n">REAL</span><span class="o">:=</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:CNTRL:Kp2 &#39;</span><span class="p">}</span>
    <span class="n">fKp2</span> <span class="p">:</span> <span class="n">REAL</span><span class="o">:=</span> <span class="mf">0.01</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:CNTRL:Tn2 &#39;</span><span class="p">}</span>
    <span class="n">fTn2</span> <span class="p">:</span> <span class="n">REAL</span><span class="o">:=</span> <span class="mf">0.5</span><span class="p">;</span>


<span class="n">END_VAR</span>
</pre></div>
</div>
</div>
<div class="section" id="gvl-vac-intf">
<h2>GVL_VAC_INTF<a class="headerlink" href="#gvl-vac-intf" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VAR_GLOBAL</span>
    <span class="n">ads_watch_dog</span>   <span class="p">:</span>       <span class="n">FB_ADS_WATCHDOG</span><span class="p">;</span>
<span class="n">END_VAR</span>
</pre></div>
</div>
</div>
<div class="section" id="gvl-variables">
<h2>GVL_VARIABLES<a class="headerlink" href="#gvl-variables" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VAR_GLOBAL</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:OVERRIDE_VAC &#39;</span><span class="p">}</span>
    <span class="n">xSystemOverrideMode</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span> <span class="p">(</span><span class="o">*</span> <span class="n">Global</span> <span class="n">system</span> <span class="n">override</span> <span class="k">for</span> <span class="n">the</span> <span class="n">prototype</span> <span class="n">section</span><span class="o">*</span><span class="p">)</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:AUTO_VVC_40 &#39;</span><span class="p">}</span>
    <span class="n">bAutoVVC40</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="kc">False</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">EM1K0</span><span class="p">:</span><span class="n">GMD</span><span class="p">:</span><span class="n">GAS_TYPE</span> <span class="p">;</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">mbbi</span> <span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZRST</span> <span class="n">none</span> <span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONST</span> <span class="n">Neon</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">TWST</span> <span class="n">Argon</span> <span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">THST</span> <span class="n">Krypton</span> <span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">FRST</span> <span class="n">Xenon</span> <span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="n">SelectedGas</span><span class="p">:</span> <span class="n">E_GasType</span><span class="p">;</span>

            <span class="o">//</span> <span class="n">Purge</span> <span class="n">COMMANDS</span> <span class="n">FROM</span> <span class="n">epics</span>
    <span class="o">//</span><span class="n">pragma</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:Purge_SW&#39;</span><span class="p">}</span>
    <span class="n">bStartPurge_sw</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span><span class="n">false</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:Purge_Active&#39;</span><span class="p">}</span>
    <span class="n">bPurgeActive</span> <span class="p">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="n">false</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:PurgeDone&#39;</span><span class="p">}</span>
    <span class="n">bPurgeDone</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span><span class="n">false</span><span class="p">;</span>

    <span class="n">fbLogHandler</span> <span class="p">:</span> <span class="n">FB_LogHandler</span><span class="p">;</span>
<span class="n">END_VAR</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="pous">
<h1>POUs<a class="headerlink" href="#pous" title="Permalink to this headline">¶</a></h1>
<div class="section" id="f-hv-ilk">
<h2>F_HV_ILK<a class="headerlink" href="#f-hv-ilk" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION</span> <span class="n">F_HV_ILK</span> <span class="p">:</span> <span class="n">BOOL</span>
<span class="n">VAR_INPUT</span>
    <span class="n">IG</span>      <span class="p">:</span>       <span class="n">ST_VG</span><span class="p">;</span> <span class="o">//</span> <span class="n">Gauge</span> <span class="n">used</span> <span class="k">for</span> <span class="n">interlocking</span> <span class="n">the</span> <span class="n">high</span> <span class="n">voltage</span> <span class="n">supply</span>
    <span class="n">HV</span>      <span class="p">:</span>       <span class="n">ST_HV</span><span class="p">;</span> <span class="o">//</span> <span class="n">Structure</span> <span class="n">representing</span> <span class="n">HV</span> <span class="n">control</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
<span class="n">END_VAR</span>
<span class="n">F_HV_ILK</span> <span class="o">:=</span> <span class="p">((</span><span class="n">IG</span><span class="o">.</span><span class="n">xPRESS_OK</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span>
                    <span class="n">AND</span> <span class="p">(</span><span class="n">IG</span><span class="o">.</span><span class="n">rPRESS</span> <span class="o">&lt;</span> <span class="n">HV</span><span class="o">.</span><span class="n">rPRO_SP</span><span class="p">));</span>

<span class="n">END_FUNCTION</span>
</pre></div>
</div>
</div>
<div class="section" id="f-turbo-prot-slnd-ilk">
<h2>F_TURBO_PROT_SLND_ILK<a class="headerlink" href="#f-turbo-prot-slnd-ilk" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION</span> <span class="n">F_TURBO_PROT_SLND_ILK</span> <span class="p">:</span> <span class="n">BOOL</span>
<span class="n">VAR_INPUT</span>
    <span class="n">i_Turbo</span> <span class="p">:</span> <span class="n">ST_PTM</span><span class="p">;</span> <span class="o">//</span> <span class="n">Turbo</span> <span class="n">Pump</span>
    <span class="n">i_stISG</span> <span class="p">:</span> <span class="n">ST_VG</span><span class="p">;</span> <span class="o">//</span><span class="n">Gauge</span> <span class="n">measuring</span> <span class="n">inlet</span> <span class="n">Pressure</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span> <span class="n">Pirani</span>
    <span class="n">i_stBSG</span> <span class="p">:</span> <span class="n">ST_VG</span><span class="p">;</span> <span class="o">//</span><span class="n">Gauge</span> <span class="n">measuring</span> <span class="n">backing</span> <span class="n">Pressure</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span> <span class="n">Pirani</span>
    <span class="n">ScrollPump</span> <span class="p">:</span> <span class="n">ST_RoughPump</span><span class="p">;</span> <span class="o">//</span> <span class="n">Roughing</span> <span class="n">pump</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
<span class="n">END_VAR</span>
<span class="n">F_TURBO_PROT_SLND_ILK</span> <span class="o">:=</span> <span class="p">(</span><span class="n">i_stISG</span><span class="o">.</span><span class="n">xPRESS_OK</span> <span class="n">AND</span> <span class="n">i_stISG</span><span class="o">.</span><span class="n">rPRESS</span> <span class="o">&lt;</span> <span class="n">i_Turbo</span><span class="o">.</span><span class="n">rInletPressureSP</span><span class="p">)</span>
                                                <span class="n">AND</span> <span class="p">(</span><span class="n">i_stBSG</span><span class="o">.</span><span class="n">xPRESS_OK</span> <span class="n">AND</span> <span class="n">i_stBSG</span><span class="o">.</span><span class="n">rPRESS</span> <span class="o">&lt;</span> <span class="n">i_Turbo</span><span class="o">.</span><span class="n">rBackingPressureSP</span><span class="p">)</span>
                            <span class="n">AND</span> <span class="p">(</span><span class="n">ScrollPump</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span><span class="p">)</span>
                                                    <span class="n">AND</span> <span class="p">(</span><span class="n">i_Turbo</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span><span class="p">);</span>

<span class="n">END_FUNCTION</span>
</pre></div>
</div>
</div>
<div class="section" id="f-turbogatevalve-protection-ilk-local">
<h2>F_TurboGateValve_Protection_ILK_local<a class="headerlink" href="#f-turbogatevalve-protection-ilk-local" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">*</span> <span class="n">This</span> <span class="n">Function</span> <span class="n">Block</span> <span class="n">evaluates</span> <span class="n">the</span> <span class="n">ILK</span> <span class="n">condition</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Turbo</span> <span class="n">Gate</span> <span class="n">valve</span> <span class="o">*</span><span class="p">)</span>
<span class="p">(</span><span class="o">*</span> <span class="n">The</span> <span class="n">logic</span> <span class="n">Protects</span> <span class="n">the</span> <span class="n">Turbo</span> <span class="n">pump</span> <span class="kn">from</span> <span class="nn">inlet</span> <span class="n">pressure</span> <span class="n">above</span> <span class="n">the</span> <span class="n">SP</span><span class="o">*</span><span class="p">)</span>
<span class="p">(</span><span class="o">*</span> <span class="n">And</span> <span class="n">Protects</span> <span class="n">the</span> <span class="n">Turbo</span> <span class="n">pump</span> <span class="kn">from</span> <span class="nn">backing</span> <span class="n">pressure</span> <span class="n">above</span> <span class="n">the</span> <span class="n">SP</span><span class="o">*</span><span class="p">)</span>
<span class="p">(</span><span class="o">*</span> <span class="n">And</span> <span class="n">Protects</span> <span class="n">the</span> <span class="n">Turbo</span> <span class="n">pump</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">case</span> <span class="n">of</span> <span class="n">backing</span> <span class="n">pump</span> <span class="ow">not</span> <span class="n">running</span><span class="o">*</span><span class="p">)</span>

<span class="p">(</span><span class="o">*</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">to</span> <span class="n">be</span> <span class="n">used</span> <span class="n">whle</span> <span class="n">the</span> <span class="n">vacuum</span> <span class="n">library</span> <span class="n">has</span> <span class="ow">not</span> <span class="n">yet</span> <span class="n">updated</span> <span class="n">to</span> <span class="n">watch</span> <span class="k">for</span> <span class="n">the</span> <span class="n">pumpRUNNING</span> <span class="n">state</span><span class="o">.</span> <span class="n">Switch</span> <span class="n">to</span> <span class="n">the</span> <span class="n">vacuum</span> <span class="n">library</span><span class="s1">&#39;s version at earliest convenience. *)</span>

<span class="n">FUNCTION</span> <span class="n">F_TurboGateValve_Protection_ILK_local</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">(</span><span class="o">*</span> <span class="n">function</span> <span class="k">return</span> <span class="n">TRUE</span> <span class="n">when</span> <span class="n">ILK</span> <span class="ow">is</span> <span class="n">OK</span><span class="o">*</span><span class="p">)</span>
<span class="n">VAR_INPUT</span>
    <span class="n">i_Turbo</span> <span class="p">:</span> <span class="n">ST_PTM</span><span class="p">;</span> <span class="o">//</span> <span class="n">Turbo</span> <span class="n">Pump</span>
    <span class="n">i_stISG</span> <span class="p">:</span> <span class="n">ST_VG</span><span class="p">;</span> <span class="o">//</span><span class="n">Gauge</span> <span class="n">measuring</span> <span class="n">inlet</span> <span class="n">Pressure</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span> <span class="n">Pirani</span>
    <span class="n">i_stBSG</span> <span class="p">:</span> <span class="n">ST_VG</span><span class="p">;</span> <span class="o">//</span><span class="n">Gauge</span> <span class="n">measuring</span> <span class="n">backing</span> <span class="n">Pressure</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span> <span class="n">Pirani</span>
    <span class="n">ScrollPump</span>      <span class="p">:</span>       <span class="n">ST_RoughPump</span><span class="p">;</span> <span class="o">//</span> <span class="n">Roughing</span> <span class="n">pump</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span> <span class="n">This</span> <span class="n">Function</span> <span class="n">Block</span> <span class="n">evaluates</span> <span class="n">the</span> <span class="n">ILK</span> <span class="n">condition</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Turbo</span> <span class="n">Gate</span> <span class="n">valve</span> <span class="o">*</span><span class="p">)</span>
<span class="p">(</span><span class="o">*</span> <span class="n">The</span> <span class="n">logic</span> <span class="n">Protects</span> <span class="n">the</span> <span class="n">Turbo</span> <span class="n">pump</span> <span class="kn">from</span> <span class="nn">inlet</span> <span class="n">pressure</span> <span class="n">above</span> <span class="n">the</span> <span class="n">SP</span><span class="o">*</span><span class="p">)</span>
<span class="n">F_TurboGateValve_Protection_ILK_local</span> <span class="o">:=</span> <span class="p">(</span><span class="n">i_Turbo</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span><span class="p">)</span>
                                            <span class="n">AND</span> <span class="p">(</span><span class="n">i_stISG</span><span class="o">.</span><span class="n">xPRESS_OK</span> <span class="n">AND</span> <span class="n">i_stISG</span><span class="o">.</span><span class="n">rPRESS</span> <span class="o">&lt;</span> <span class="n">i_Turbo</span><span class="o">.</span><span class="n">rInletPressureSP</span><span class="p">)</span>
                                            <span class="n">AND</span> <span class="p">(</span><span class="n">i_stBSG</span><span class="o">.</span><span class="n">xPRESS_OK</span> <span class="n">AND</span> <span class="n">i_stBSG</span><span class="o">.</span><span class="n">rPRESS</span> <span class="o">&lt;</span> <span class="n">i_Turbo</span><span class="o">.</span><span class="n">rBackingPressureSP</span><span class="p">)</span>
                                            <span class="n">AND</span> <span class="p">(</span><span class="n">ScrollPump</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span><span class="p">);</span>

<span class="n">END_FUNCTION</span>
</pre></div>
</div>
</div>
<div class="section" id="fb-highvoltage">
<h2>FB_HighVoltage<a class="headerlink" href="#fb-highvoltage" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_HighVoltage</span>
<span class="n">VAR_INPUT</span>
    <span class="n">i_xExtIlkOK</span>     <span class="p">:</span>       <span class="n">BOOL</span><span class="p">;</span> <span class="o">//</span><span class="n">External</span> <span class="n">Interlock</span><span class="p">,</span> <span class="n">SET</span> <span class="n">to</span> <span class="n">TRUE</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">used</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span>
    <span class="s1">&#39;}</span>
    <span class="n">hv</span><span class="p">:</span><span class="n">ST_HV</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="p">(</span><span class="o">*</span><span class="n">outputs</span><span class="o">*</span><span class="p">)</span>
    <span class="n">q_HV_DO</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">hv</span><span class="o">.</span><span class="n">xIlkOK</span> <span class="o">:=</span> <span class="n">i_xExtIlkOK</span><span class="p">;</span>

<span class="n">q_HV_DO</span> <span class="o">:=</span> <span class="n">hv</span><span class="o">.</span><span class="n">HV_sw</span> <span class="n">AND</span> <span class="n">hv</span><span class="o">.</span><span class="n">xIlkOK</span><span class="p">;</span>

<span class="p">(</span><span class="o">*</span><span class="n">soft</span> <span class="n">io</span> <span class="n">mapping</span><span class="o">*</span><span class="p">)</span>
<span class="n">hv</span><span class="o">.</span><span class="n">q_HV_DO</span> <span class="o">:=</span> <span class="n">q_HV_DO</span><span class="p">;</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="fb-pressuretransducer">
<h2>FB_PressureTransducer<a class="headerlink" href="#fb-pressuretransducer" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>FUNCTION_BLOCK FB_PressureTransducer
VAR_OUTPUT
    {attribute &#39;pytmc&#39; := &#39;pv:&#39;}
    Sensor : ST_PressureSensor;
END_VAR

VAR_INPUT
    rDefaultSP : REAL; (* Must assign a default value at instantiation*)
    i_rFULL_SCALE: REAL;
END_VAR

VAR
    iCurrent : REAL;
    AlarmTOF : TOF;

    (*IOs to be linked*)
    iError AT %I* : BOOL; // Link to terminal diagnostics
    i_iPRESS_R AT %I* :INT; // input Pressure // Link to analog Input
END_VAR
// for SETRA  4-20mA outout

(* Real-value calculation *)
Sensor.rFull_Scale:=i_rFULL_SCALE;
iCurrent := 20*INT_TO_REAL(Sensor.iPRESS_R)/32767;

  IF iError THEN; //reading less than 4mA
     Sensor.rPRESS := -1;
     Sensor.xPStateAlarm:= TRUE;
     ELSE
             Sensor.rPRESS := LREAL_TO_REAL(iCurrent*Sensor.rFull_Scale); //FULL scale in Psi for pressure transducer ???
  END_IF

 (* Validate setpoint *)
    IF (Sensor.rPressSP &lt; Sensor.rMinPressSP OR Sensor.rPressSP &gt; Sensor.rMaxPressSP) THEN;
            Sensor.rPressSP := rDefaultSP;
    END_IF

 (* Set alarm bit when pressure lower and equal to setpoint, delay off for 60s*)

  AlarmTOF (IN := Sensor.rPRESS &lt;= Sensor.rPressSP, PT := T#60S, Q =&gt; Sensor.xPstateAlarm);




 (*Soft IO Mapping*)
  ACT_IO();

END_FUNCTION_BLOCK
ACTION ACT_IO:
Sensor.iPRESS_R := i_iPRESS_R;
END_ACTION
</pre></div>
</div>
</div>
<div class="section" id="fb-rtd">
<h2>FB_RTD<a class="headerlink" href="#fb-rtd" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_RTD</span>
<span class="n">VAR_INPUT</span>
    <span class="n">iScale</span><span class="p">:</span> <span class="n">INT</span> <span class="o">:=</span> <span class="mi">10</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
            <span class="n">pv</span><span class="p">:</span> <span class="n">TEMP</span>
            <span class="n">io</span><span class="p">:</span> <span class="nb">input</span>
    <span class="s1">&#39;}</span>
    <span class="n">fTemp</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
            <span class="n">pv</span><span class="p">:</span> <span class="n">CONN</span>
            <span class="n">io</span><span class="p">:</span> <span class="nb">input</span>
            <span class="n">ONAM</span><span class="p">:</span> <span class="n">Connected</span>
            <span class="n">ZNAM</span><span class="p">:</span> <span class="n">Disconnected</span>
    <span class="s1">&#39;}</span>
    <span class="n">bConnected</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
            <span class="n">pv</span><span class="p">:</span> <span class="n">ERR</span>
            <span class="n">io</span><span class="p">:</span> <span class="nb">input</span>
    <span class="s1">&#39;}</span>
    <span class="n">bError</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">bUnderrange</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bOverrange</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">iRaw</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">INT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">bConnected</span> <span class="o">:=</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">bOverrange</span> <span class="n">AND</span> <span class="n">bError</span><span class="p">);</span>
<span class="n">fTemp</span> <span class="o">:=</span> <span class="n">iRaw</span> <span class="o">/</span> <span class="n">iScale</span><span class="p">;</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</div>
<div class="section" id="fb-vgp">
<h2>FB_VGP<a class="headerlink" href="#fb-vgp" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(* This function implements the Basic functions for the Vat Motorized valve*)
{attribute &#39;no_check&#39;}
FUNCTION_BLOCK FB_VGP
VAR_INPUT
    i_xExtIlkOK     :       BOOL; //External Interlock, SET to TRUE if not used
    i_xOpenIlkOK: BOOL; //Interlock Bit that allows the valve to open
    i_xCloseIlkOK: BOOL; //Interlock Bit that allows the valve to Close

    i_ReqPos        :       REAL; //Requested position

    arrTable        : ARRAY[1..14,1..2] OF FLOAT;
END_VAR
VAR_OUTPUT
    {attribute &#39;pytmc&#39; := &#39;
    pv:
    &#39;}
    q_stVGP :       ST_VGP; // valve structure
END_VAR
VAR_IN_OUT

END_VAR

VAR CONSTANT
    rUpperLimit     :       REAL:=100;      //Percentage Upper limit on valve open
    rClosePosition : REAL:=0; // Encoder Min. Fully Closed
    rMaxDiffPressure: REAL:= 22.5; //Torr
END_VAR

VAR
    rOpenPosition: REAL:=1660; // Encoder MAX. Fully Open
    rTargetPosition : REAL;
    rTargetVelocity: REAL:=30;
    rHomingVelocity: REAL:=10;
    rHomingDistance: REAL:=-20;//every 150 is 10% , 1%  is 14.975
    rOldTargetPosition: REAL;
    rHyst:REAL :=10;
    //
    /// axis reference data structure
    Axis: AXIS_REF;
    //
    InfoData_State AT %I*: UINT ;

    // Axis MC functions

    fbPowerAxis: MC_Power;
    /// debug function block output data
    PowerAxisOut: ST_McOutputs;
    fbMoveAxisABS: MC_MoveAbsolute;
    /// debug function block output data
    MoveAbsoluteOut: ST_McOutputs;
    fbMoveAxisABS2: MC_MoveAbsolute;
    /// debug function block output data
    MoveAbsoluteOut2: ST_McOutputs;

    fbReset: MC_Reset;
    /// debug function block output data
    ResetOut: ST_McOutputs;
    MoveAxisREL: MC_MoveAbsolute;
    MoveRelativeOut: ST_McOutputs;



    rOverride: LREAL := 100;
    fbHalt: MC_Halt;


    // Homing Functions
    bGo:BOOL := FALSE; //to execute motion
    bHome:BOOL :=FALSE; // should be set to true
    bEnable:Bool; //to be removed
    fbMoveRel: MC_MoveRelative;
    fbSetPosition: MC_SetPosition;
    fbWriteParameter: MC_WriteBoolParameter;
    HomeState: E_HomeState;

    // For Monitoring while Axis moving
    rPrevEncoderPosition : REAL;
    // interpolation
    bInit : BOOL := TRUE;
    eMode           : E_CTRL_MODE;
    iCounter:INT;
    //CONTROL
    stCTRL_LIN_INTERPOLATION_PARAMS         : ST_CTRL_LIN_INTERPOLATION_PARAMS;
    fbCTRL_LIN_INTERPOLATION                                        : FB_CTRL_LIN_INTERPOLATION;
    arrTable_ENC : ARRAY[1..14,1..2] OF FLOAT;
    //Readdback
    stCTRL_LIN_INTERPOLATION_PARAMS_ENC             : ST_CTRL_LIN_INTERPOLATION_PARAMS;
    fbCTRL_LIN_INTERPOLATION_ENC                                    : FB_CTRL_LIN_INTERPOLATION;

    // Logger
     // For logging
    fbLogger : FB_LogMessage := (eSubsystem:=E_SubSystem.VACUUM);
    ePrevState : E_VCN;
    tErrorPresent : R_TRIG;
    tAction : R_TRIG; // Primary action of this device (OPN_DO, PUMP_RUN, etc.)

    rt_close :R_TRIG;
    rt_Open :R_TRIG;
END_VAR
/// Interpolation  function initialization
ACT_INIT();

// Interlocking
q_stVGP.xIlkOK := i_xExtIlkOK;
(*Checking which Control mode is selected*)
IF i_xExtIlkOK AND NOT (q_stVGP.pv_xError) THEN
    IF q_stVGP.eValveControl = OpenValve THEN
            q_stVGP.rReqPosition := rUpperLimit;
    ELSIF q_stVGP.eValveControl = CloseValve THEN
            q_stVGP.rReqPosition := 0;
    ELSIF q_stVGP.eValveControl = ManualControl THEN
            q_stVGP.rReqPosition := LIMIT(0, q_stVGP.rReqPosition, rUpperLimit);
    ELSIF q_stVGP.eValveControl = PressureControl THEN
             q_stVGP.rReqPosition := LIMIT(0, i_ReqPos, rUpperLimit);
    END_IF
ELSIF NOT i_xExtIlkOK THEN
    q_stVGP.rReqPosition := 0;
    q_stVGP.eValveControl := CloseValve;//CloseValve;
END_IF

rt_close (CLK:= q_stVGP.eValveControl = CloseValve);
rt_Open (CLK:= q_stVGP.eValveControl = OpenValve);

IF (rt_close.Q) OR (rt_Open.Q) THEN
    q_stVGP.pv_xGo_SW:=TRUE;
END_IF
//Check the Drive State

IF (*(InfoData_State&lt;&gt;16#8) OR*) (q_stVGP.eState = ERROR) THEN
    q_stVGP.pv_xError:=TRUE;
ELSE
    q_stVGP.pv_xError:=FALSE;
    // Call function to execute move
    // call motion function blocks???
END_IF


IF (q_stVGP.pv_xABORT_SW ) THEN
    q_stVGP.pv_xABORT_SW := FALSE;
    q_stVGP.eState:= ABORT;
    HomeState:= H_READY;
END_IF


ACT_LIN_INTERPOLATION();
ACT_AXIS();
ACT_HOME();
ACT_MONITOR();

END_FUNCTION_BLOCK
ACTION ACT_AXIS:
//update the axis status
AXIS();
q_stVGP.rEnoder_Position := LREAL_TO_REAL(Axis.NcToPlc.ActPos); // encoder position

(*
IF NOT (i_xExtIlkOK) THEN
    q_stVGP.eState := NEWTARGETPOSITION;
END_IF*)
//Homing STATE is missing

// state machine for axis motion
    (* move axis using a state machine *)
    CASE q_stVGP.eState OF

            INIT :  (* initialisation *)
                    (* initialize all function blocks *)
                    fbMoveAxisABS.Execute := FALSE;
                    fbMoveAxisABS2.Execute := FALSE;
                    fbReset.Execute := FALSE;
                    fbHALT.Execute :=FALSE;//
                    q_stVGP.eState := ENABLE; // Check homing first
                    HomeState:= H_READY;

            ENABLE :
                    fbPowerAxis.Enable :=  TRUE;
                    fbPowerAxis.Enable_Positive := TRUE;
                    fbPowerAxis.Enable_Negative := TRUE;
                    IF fbPowerAxis.Status THEN
                            q_stVGP.eState := READY;
                    ELSIF fbPowerAxis.Error THEN
                            q_stVGP.eState := ERROR;
                    END_IF

            READY: // waiting for move command
                    IF NOT fbPowerAxis.Status THEN
                            q_stVGP.eState := ENABLE;
                    ELSIF fbPowerAxis.Error THEN
                            q_stVGP.eState := ERROR;
                    END_IF
                    IF (HomeState = H_READY) AND (q_stVGP.pv_xHome_SW) THEN
                                    HomeState:= H_INIT;
                                    q_stVGP.pv_xHome_SW:=false;
                                    q_stVGP.eState := HOME;
                                    ELSE
                                    q_stVGP.eState := READY;
                            END_IF
                    IF (q_stVGP.pv_xGo_SW) AND q_stVGP.pv_xHomed(* AND( rOldTargetPosition &lt;&gt; rTargetPosition) *) THEN
                            q_stVGP.pv_xGo_SW := false;
                            q_stVGP.eState := NEWTARGETPOSITION;
                            rOldTargetPosition := rTargetPosition;
                    END_IF


            HOME:
                            if (HomeState = H_DONE) THEN
                                     q_stVGP.eState := INIT;
                                     q_stVGP.pv_xHomed := TRUE;
                                     HomeState := H_READY;
                            END_IF

                            if (HomeState = H_ERROR) THEN
                                    q_stVGP.eState := ERROR;
                                      q_stVGP.pv_xHomed := FALSE;
                            END_IF

            NEWTARGETPOSITION:
                    fbMoveAxisABS.Position := rTargetPosition;
                    fbMoveAxisABS.Velocity := rTargetVelocity;
                    //fbMoveAxisABS.BufferMode := MC_BlendingNext;
                    fbMoveAxisABS.Execute := TRUE;
                    IF fbMoveAxisABS.Active  THEN
                            (* axis is executing job but is not yet finished *)
                            fbMoveAxisABS.Execute := FALSE;
                            (* leave this state and buffer a second command *)
                            q_stVGP.eState := MOVING;
                    ElSIF fbMoveAxisABS.Done THEN
                            fbMoveAxisABS.Execute := FALSE;
                            q_stVGP.eState := READY;
                    ELSIF fbMoveAxisABS.CommandAborted OR fbMoveAxisABS.Error THEN
                            q_stVGP.eState := ERROR;
                    END_IF


            MOVING://
                    IF fbMoveAxisABS.CommandAborted OR fbMoveAxisABS.Error THEN
                            q_stVGP.eState := ERROR;
                    END_IF
                    IF NOT ( Axis.Status.Moving) OR (fbMoveAxisABS.Done) THEN //(fbMoveAxisABS.Done) AND (fbMoveAxisABS2.Done) THEN
                            q_stVGP.eState := READY;
                    END_IF


            HALT:
                    fbHALT.Execute :=TRUE;
                    IF Axis.Status.Error THEN
                            q_stVGP.eState := RESET;        (* axis error requires reset *)
                    ELSE
                            q_stVGP.eState := INIT;         (* function block errors don&#39;t need a reset *)
                    END_IF

            ERROR :
                    IF HomeState = H_READY THEN
                            q_stVGP.eState := RESET;
                    ELSE
                            q_stVGP.eState := HOME;
                    END_IF

            RESET :
                    //fbReset.Execute := TRUE;
                    IF fbReset.Done THEN q_stVGP.eState :=INIT;
                    //      HomeState := H_READY;
                    ELSIF fbReset.Error THEN
                            q_stVGP.eState := ERROR; (* keep trying to reset*)
                    END_IF

            ABORT:
                    fbMoveAxisABS.Execute := FALSE;
                    fbMoveAxisABS2.Execute := FALSE;
                    fbReset.Execute := FALSE;
                    (* save target position*)
                    rOldTargetPosition :=   q_stVGP.i_iPosition;
                    fbHALT.Execute :=FALSE;
                    fbPowerAxis.Enable := FALSE;
                    fbPowerAxis.Enable_Positive := FALSE;
                    fbPowerAxis.Enable_Negative := FALSE;
                    q_stVGP.eState := ENABLE; // Check homing first

    END_CASE






/// Motion Function Blocks
(* AXIS POWER*)
fbPowerAxis(
    Axis:= Axis,
    Enable:= ,
    Enable_Positive:= i_xOpenIlkOK,
    Enable_Negative:= ,
    Override:= rOverride,
    BufferMode:= ,
    Options:= ,
    Status=&gt;  ,
    Busy=&gt; PowerAxisOut.Busy ,
    Active=&gt; PowerAxisOut.Active ,
    Error=&gt; PowerAxisOut.Error,
    ErrorID=&gt; PowerAxisOut.ErrorID);
(* AXIS MOVE ABSOLUTE*)
fbMoveAxisABS(
    Axis:= Axis ,
    Execute:= ,
    Position:= ,
    Velocity:= ,
    Acceleration:= ,
    Deceleration:= ,
    Jerk:= ,
    BufferMode:= MC_BlendingNext ,
    Options:= ,
    Done=&gt;MoveAbsoluteOut.Done,
    Busy=&gt; MoveAbsoluteOut.Busy,
    Active=&gt; MoveAbsoluteOut.Active,
    CommandAborted=&gt; MoveAbsoluteOut.CommandAborted ,
    Error=&gt; MoveAbsoluteOut.Error,
    ErrorID=&gt; MoveAbsoluteOut.ErrorID);
    (* AXIS MOVE ABSOLUTE*)
fbMoveAxisABS2(
    Axis:= Axis ,
    Execute:= ,
    Position:= ,
    Velocity:= ,
    Acceleration:= ,
    Deceleration:= ,
    Jerk:= ,
    BufferMode:= MC_BlendingNext ,
    Options:= ,
    Done=&gt;MoveAbsoluteOut2.Done,
    Busy=&gt; MoveAbsoluteOut2.Busy,
    Active=&gt; MoveAbsoluteOut2.Active,
    CommandAborted=&gt; MoveAbsoluteOut2.CommandAborted ,
    Error=&gt; MoveAbsoluteOut2.Error,
    ErrorID=&gt; MoveAbsoluteOut2.ErrorID);
(*AXIS RESET*)
fbReset(
    Axis:= Axis,
    Execute:= This^.q_stVGP.pv_xReset_SW ,
    Done=&gt;ResetOut.Done ,
    Busy=&gt;ResetOut.Busy ,
    Error=&gt; ResetOut.Error,
    ErrorID=&gt; ResetOut.ErrorID);

(*HALT*)
fbHalt(
    Axis:= Axis,
    Execute:= ,
    Deceleration:= ,
    Jerk:= ,
    BufferMode:= MC_BlendingNext ,
    Options:= ,
    Done=&gt; ,
    Busy=&gt; ,
    Active=&gt; ,
    CommandAborted=&gt; ,
    Error=&gt; ,
    ErrorID=&gt; );


/// ERROR
IF Axis.Status.Error  THEN
    q_stVGP.eState := ERROR;
END_IF;

// Error Handling
if( fbPowerAxis.Error and fbPowerAxis.Active ) then
    This^.q_stVGP.pv_xError:= fbPowerAxis.Error;
    This^.q_stVGP.nErrorID:= fbPowerAxis.ErrorID;
END_IF
if( fbMoveAxisABS.Error and fbMoveAxisABS.Active ) then
    This^.q_stVGP.pv_xError:= fbMoveAxisABS.Error;
    This^.q_stVGP.nErrorID:= fbMoveAxisABS.ErrorID;
END_IF

IF This^.q_stVGP.pv_xReset_SW THEN This^.q_stVGP.pv_xReset_SW:=FALSE; END_IF
(*Convert nErrorID to string*)
This^.q_stVGP.sErrorMessage:=WORD_TO_HEXSTR(in:=TO_WORD(This^.q_stVGP.nErrorID) , iPrecision:= 4, bLoCase:=0 );

This^.q_stVGP.xBusy := (NOT(q_stVGP.eState = READY) AND (HomeState = H_READY));
END_ACTION
ACTION ACT_HOME:
CASE HomeState OF
    H_READY:
            fbSetPosition.Execute := FALSE;
            fbWriteParameter.Execute := FALSE;
            fbMoveRel.Execute := FALSE;

    H_INIT:
    HomeState:=H_RESET_LL;


    H_RESET_LL:
            // disable soft limits in order to be able to move the drive
            fbWriteParameter.ParameterNumber := MC_AxisParameter.EnableLimitNeg;//EnableLimitPos;// .EnableLimitNeg;
            fbWriteParameter.Value := FALSE;
            fbWriteParameter.Execute := TRUE;
            if (fbWriteParameter.Done) THEN
                    fbWriteParameter.Execute := FALSE;
                    HomeState:= H_RESET_HL;
            END_IF

    H_RESET_HL:
            // disable soft limits in order to be able to move the drive
            fbWriteParameter.ParameterNumber := MC_AxisParameter.EnableLimitPos;
            fbWriteParameter.Value := FALSE;
            fbWriteParameter.Execute := TRUE;
            if (fbWriteParameter.Done) THEN
                    fbWriteParameter.Execute := FALSE;
                    HomeState:= H_ENABLE;
            END_IF

    H_ENABLE:
            // Make Sure drive is enabled
            fbPowerAxis.Enable :=  TRUE;
            fbPowerAxis.Enable_Positive := TRUE;
            fbPowerAxis.Enable_Negative := TRUE;
            IF fbPowerAxis.Status THEN
                    HomeState:= H_MOVING;
            ELSIF fbPowerAxis.Error THEN
                    HomeState := H_ERROR;
            END_IF

    H_MOVING:
            fbMoveRel.Execute := TRUE;
            IF fbMoveRel.Active  THEN
                    (* axis is executing job but is not yet finished *)
                    fbMoveRel.Execute := FALSE;
                    (* leave this state and buffer a second command *)
                    HomeState := H_MOVING2;
            ElSIF fbMoveRel.Done THEN
                    fbMoveRel.Execute := FALSE;
                    HomeState := H_MOVING;//2?
            ELSIF fbMoveRel.CommandAborted OR fbMoveRel.Error THEN
                    fbMoveRel.Execute := FALSE;
                    HomeState := H_CHECK;
            END_IF

    H_MOVING2:
            IF fbMoveRel.CommandAborted OR fbMoveRel.Error THEN
                    HomeState := H_CHECK;
            END_IF
            IF NOT ( Axis.Status.Moving) OR (fbMoveRel.Done) THEN //(fbMoveAxisABS.Done) AND (fbMoveAxisABS2.Done) THEN
                    HomeState := H_MOVING;
                    fbMoveRel.Execute := FALSE;
            END_IF

    H_CHECK:
            //Check position lag monitoring error
            if (Axis.Status.ErrorID = 16#00004550)THEN
                    This^.q_stVGP.pv_xReset_SW := TRUE;
                    HomeState := H_RESET;
            ELSE
                    HomeState := H_ERROR;
            END_IF

    H_RESET:
            IF fbReset.Done THEN
                    This^.q_stVGP.pv_xReset_SW := FALSE;
                    HomeState := H_SET_POS;
            END_IF

    H_SET_POS:
     // Set Current Position
            fbSetPosition.Position := 0;
            fbSetPosition.Execute := TRUE;
            IF ( fbSetPosition.Done ) THEN
                    fbSetPosition.Execute := FALSE;
                    HomeState:= H_WRITE_LL;
            ELSIF (fbSetPosition.Error) THEN
                    HomeState := H_ERROR;
            END_IF


    H_WRITE_LL:
    // Re Enable the Soft limits
            fbWriteParameter.ParameterNumber := MC_AxisParameter.AxisEnMinSoftPosLimit;//AxisEnMaxSoftPosLimit;// .AxisEnMinSoftPosLimit;
            fbWriteParameter.Value := TRUE;
            fbWriteParameter.Execute := TRUE;
            if (fbWriteParameter.Done) THEN
                    fbWriteParameter.Execute := FALSE;
                    HomeState:= H_WRITE_HL;
            END_IF

    H_WRITE_HL:
    // Re Enable the Soft limits
            fbWriteParameter.ParameterNumber := MC_AxisParameter.AxisEnMaxSoftPosLimit;
            fbWriteParameter.Value := TRUE;
            fbWriteParameter.Execute := TRUE;
            if (fbWriteParameter.Done) THEN
                    fbWriteParameter.Execute := FALSE;
                    HomeState:= H_DONE;
            END_IF


    H_ERROR:
            //taken care of in the axis motion state machine
    H_DONE:
            //taken care of in the axis motion state machine

END_CASE

// Move backward to fully closed
fbMoveRel(
    Axis:= Axis ,
    Execute:= ,
    Distance:= rHomingDistance ,
    Velocity:= rHomingVelocity,
    Acceleration:= ,
    Deceleration:= ,
    Jerk:= ,
    BufferMode:= MC_BlendingNext,
    Options:= ,
    Done=&gt; ,
    Busy=&gt; ,
    Active=&gt; ,
    CommandAborted=&gt; ,
    Error=&gt; ,
    ErrorID=&gt; );

// Set Encoder Position
fbSetPosition(
    Axis:= Axis ,
    Execute:= ,
    Position:= 0 ,
    Mode:= FALSE, //Absolute
    Options:= ,
    Done=&gt; ,
    Busy=&gt; ,
    Error=&gt; ,
    ErrorID=&gt; );

// Write Parameters
fbWriteParameter(
    Axis:= Axis ,
    Execute:= ,
    ParameterNumber:= ,
    Value:= ,
    Done=&gt; ,
    Busy=&gt; ,
    Error=&gt; ,
    ErrorID=&gt; );

If ( fbWriteParameter.Error) OR (fbSetPosition.Error)(* OR (fbMoveRel.Error) *)THEN
    HomeState:= H_ERROR;
    q_stVGP.eState := ERROR;
END_IF
END_ACTION
ACTION ACT_INIT:
{attribute no_check}
IF bInit THEN

(*
    (* init array with the interpolation points  *)
    (*      fIn                                      |              fOut            *)
    arrTable[1,1] := 0;                     arrTable[1,2] := 0;
    arrTable[2,1] := 5;                 arrTable[2,2] := 135;
    arrTable[3,1] := 10;            arrTable[3,2] := 245;
    arrTable[4,1] :=  20;       arrTable[4,2] := 405;
    arrTable[5,1] :=  30;       arrTable[5,2] := 535;
    arrTable[6,1] := 40;            arrTable[6,2] := 689;
    arrTable[7,1] := 50;            arrTable[7,2] := 830;
    arrTable[8,1] := 60;        arrTable[8,2] := 960;
    arrTable[9,1] := 70;        arrTable[9,2] := 1095;
    arrTable[10,1] := 80;           arrTable[10,2] := 1225;
    arrTable[11,1] := 90;           arrTable[11,2] := 1415;
    arrTable[12,1] := 95;           arrTable[12,2] := 1495;
    arrTable[13,1] := 98;           arrTable[13,2] := 1559;
    arrTable[14,1] := 100;          arrTable[14,2] := 1645;
    *)

    (* init parameter struct *)
    stCTRL_LIN_INTERPOLATION_PARAMS.tCtrlCycleTime                                  := T#10ms;
    stCTRL_LIN_INTERPOLATION_PARAMS.tTaskCycleTime                                  := T#10ms;
    stCTRL_LIN_INTERPOLATION_PARAMS.nDataTable_NumberOfRows         := INT_TO_UINT(14);

    (* set the addresses *)
    stCTRL_LIN_INTERPOLATION_PARAMS.pDataTable_ADR                  := ADR(arrTable);
    stCTRL_LIN_INTERPOLATION_PARAMS.nDataTable_SIZEOF               := SIZEOF(arrTable);

    (* set the mode to ACTIVE --&gt; normal operation *)
    eMode                                                   := eCTRL_MODE_ACTIVE;


    (* init array with the interpolation points  *)
    (*      fIn                                      |              fOut            *)
     FOR iCounter:=1 TO 14 BY 1 DO
            arrTable_ENC[iCounter,1] := arrTable[iCounter,2];
            arrTable_ENC[iCounter,2] := arrTable[iCounter,1];
     END_FOR;
    (*
    arrTable_ENC[1,1] := 0;                 arrTable_ENC[1,2] := 0;
    arrTable_ENC[2,1] := 135;                   arrTable_ENC[2,2] := 5;
    arrTable_ENC[3,1] := 245;               arrTable_ENC[3,2] := 10;
    arrTable_ENC[4,1] :=  405;          arrTable_ENC[4,2] := 20;
    arrTable_ENC[5,1] :=  535;          arrTable_ENC[5,2] := 30;
    arrTable_ENC[6,1] := 689;               arrTable_ENC[6,2] := 40;
    arrTable_ENC[7,1] := 830;               arrTable_ENC[7,2] := 50;
    arrTable_ENC[8,1] := 960;           arrTable_ENC[8,2] := 60;
    arrTable_ENC[9,1] := 1095;          arrTable_ENC[9,2] := 70;
    arrTable_ENC[10,1] := 1225;             arrTable_ENC[10,2] := 80;
    arrTable_ENC[11,1] := 1415;             arrTable_ENC[11,2] := 90;
    arrTable_ENC[12,1] := 1495;             arrTable_ENC[12,2] := 95;
    arrTable_ENC[13,1] := 1559;             arrTable_ENC[13,2] := 98;
    arrTable_ENC[14,1] := 1645;             arrTable_ENC[14,2] := 100;*)


    (* init parameter struct *)
    stCTRL_LIN_INTERPOLATION_PARAMS_ENC.tCtrlCycleTime                                      := T#10ms;
    stCTRL_LIN_INTERPOLATION_PARAMS_ENC.tTaskCycleTime                                      := T#10ms;
    stCTRL_LIN_INTERPOLATION_PARAMS_ENC.nDataTable_NumberOfRows             := INT_TO_UINT(14);

    (* set the addresses *)
    stCTRL_LIN_INTERPOLATION_PARAMS_ENC.pDataTable_ADR                      := ADR(arrTable_ENC);
    stCTRL_LIN_INTERPOLATION_PARAMS_ENC.nDataTable_SIZEOF           := SIZEOF(arrTable_ENC);

    (* reset the init flag *)
    bInit                                                   := FALSE;

END_IF;
END_ACTION
ACTION ACT_LIN_INTERPOLATION:
{attribute &#39;no_check&#39;}
fbCTRL_LIN_INTERPOLATION(
    fIn:= q_stVGP.rReqPosition ,
    fManValue:= 0,
    bExtrapolate:= ,
    eMode:= eMode,
    fOut=&gt; ,
    bInIsGreaterThanMaxElement=&gt; ,
    bInIsLessThanMinElement=&gt; ,
    eState=&gt; ,
    eErrorId=&gt; ,
    bError=&gt; ,
    stParams:= stCTRL_LIN_INTERPOLATION_PARAMS );

// Target position Calculation
rTargetPosition := LREAL_TO_REAL(fbCTRL_LIN_INTERPOLATION.fOut);
//rTargetPosition := LIMIT(rClosePosition, rTargetPosition, rOpenPosition);

fbCTRL_LIN_INTERPOLATION_ENC(
    fIn:= Axis.NcToPlc.ActPos ,
    fManValue:= 0,
    bExtrapolate:= ,
    eMode:= eMode,
    fOut=&gt;  ,
    bInIsGreaterThanMaxElement=&gt; ,
    bInIsLessThanMinElement=&gt; ,
    eState=&gt; ,
    eErrorId=&gt; ,
    bError=&gt; ,
    stParams:= stCTRL_LIN_INTERPOLATION_PARAMS_ENC );
q_stVGP.i_iPosition := LREAL_TO_REAL(fbCTRL_LIN_INTERPOLATION_ENC.fOut);
END_ACTION
ACTION ACT_MONITOR:
IF (This^.q_stVGP.xBusy) THEN
    rPrevEncoderPosition:= This^.q_stVGP.rEnoder_Position;
ELSIF NOT((rPrevEncoderPosition &lt; This^.q_stVGP.rEnoder_Position +rHyst) AND (rPrevEncoderPosition &gt; This^.q_stVGP.rEnoder_Position -rHyst)) AND NOT( q_stVGP.eState =HOME)  AND NOT( q_stVGP.eState =ERROR) THEN
      q_stVGP.eState := ERROR;
      q_stVGP.pv_xHomed := FALSE;
      This^.q_stVGP.pv_xError := TRUE;
      This^.q_stVGP.sErrorMessage := &#39;Encoder Position Error&#39;;

END_IF

tErrorPresent(CLK:=q_stVGP.pv_xError);
IF tErrorPresent.Q THEN fbLogger(sMsg:=q_stVGP.sErrorMessage, eSevr:=TcEventSeverity.Error); END_IF

// Log valve motion
tAction(CLK:= q_stVGP.pv_xGo_SW);
IF tAction.Q THEN fbLogger(sMsg:=&#39;Valve commanded to move&#39;, eSevr:=TcEventSeverity.Info); END_IF


IF ePrevState &lt;&gt; q_stVGP.eValveControl THEN
      CASE q_stVGP.eValveControl OF

            CloseValve:
                    fbLogger(sMsg:=&#39;Valve set to Close.&#39;, eSevr:=TcEventSeverity.Info);
            OpenValve:
                    fbLogger(sMsg:=&#39;Valve set to Open.&#39;, eSevr:=TcEventSeverity.Info);
            PressureControl:
                    fbLogger(sMsg:=&#39;Valve set to pressure control mode.&#39;, eSevr:=TcEventSeverity.Info);
            ManualControl:
                    fbLogger(sMsg:=&#39;Valve set to manual control mode.&#39;, eSevr:=TcEventSeverity.Info);
      END_CASE
      ePrevState := q_stVGP.eValveControl;
  END_IF
END_ACTION
</pre></div>
</div>
</div>
<div class="section" id="main">
<h2>MAIN<a class="headerlink" href="#main" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">MAIN</span>
<span class="n">VAR</span>
    <span class="n">vgp_debug_mode</span>  <span class="p">:</span><span class="n">BOOL</span>   <span class="o">:=</span> <span class="kc">False</span><span class="p">;</span>
    <span class="n">gas_selection_debug_mode</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">press_cntrl</span> <span class="p">:</span><span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">PRG_DIAGNOSTIC</span><span class="p">();</span>
<span class="n">PRG_GMD</span><span class="p">();</span>
<span class="n">PRG_VAC_INTF</span><span class="p">();</span>


<span class="p">(</span><span class="o">*</span><span class="n">INJ</span><span class="o">*</span><span class="p">)</span>
<span class="n">PRG_INJ</span><span class="p">();</span>
<span class="n">PRG_PressureControl</span><span class="p">();</span>
<span class="n">PRG_Gas_Selection</span><span class="p">();</span>
<span class="n">PRG_Purge</span><span class="p">();</span>
<span class="n">IF</span> <span class="n">NOT</span> <span class="n">vgp_debug_mode</span> <span class="n">THEN</span>
    <span class="n">PRG_VGP</span><span class="p">();</span>
<span class="n">END_IF</span>


<span class="o">//</span> <span class="n">instaniate</span> <span class="n">the</span> <span class="n">RTD</span> <span class="ow">and</span> <span class="n">HV</span>

<span class="n">PRG_HV_ILK</span><span class="p">();</span>

<span class="n">fbLogHandler</span><span class="p">();</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
</div>
<div class="section" id="prg-diagnostic">
<h2>PRG_DIAGNOSTIC<a class="headerlink" href="#prg-diagnostic" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_DIAGNOSTIC</span>
<span class="n">VAR</span>
   <span class="n">fbTime</span> <span class="p">:</span> <span class="n">FB_LocalSystemTime</span> <span class="o">:=</span> <span class="p">(</span> <span class="n">bEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">dwCycle</span> <span class="o">:=</span> <span class="mi">1</span> <span class="p">);</span>
   <span class="n">logTimer</span> <span class="p">:</span> <span class="n">TON</span> <span class="o">:=</span> <span class="p">(</span> <span class="n">IN</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">PT</span> <span class="o">:=</span> <span class="n">T</span><span class="c1">#1000ms );</span>

   <span class="n">plcName</span> <span class="p">:</span> <span class="n">STRING</span><span class="p">[</span><span class="mi">15</span><span class="p">];</span>

   <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: simHeartbeat &#39;</span><span class="p">}</span>
   <span class="n">simHeartbeat</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span> <span class="n">UINT</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: plcHeartbeat &#39;</span><span class="p">}</span>
   <span class="n">plcHeartbeat</span> <span class="p">:</span> <span class="n">UDINT</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: plcInfo &#39;</span><span class="p">}</span>
   <span class="n">plcInfo</span> <span class="p">:</span> <span class="n">STRING</span><span class="p">[</span><span class="mi">40</span><span class="p">];</span>
   <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: plcLocalTime &#39;</span><span class="p">}</span>
   <span class="n">plcLocalTime</span> <span class="p">:</span> <span class="n">STRING</span><span class="p">[</span><span class="mi">25</span><span class="p">];</span>

<span class="n">END_VAR</span>
<span class="n">plcHeartbeat</span> <span class="o">:=</span> <span class="n">plcHeartbeat</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">IF</span> <span class="n">plcHeartbeat</span> <span class="o">&gt;</span> <span class="mi">4294967000</span>
   <span class="n">THEN</span> <span class="n">plcHeartbeat</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">get</span> <span class="n">timestamp</span> <span class="k">as</span> <span class="n">string</span> <span class="n">every</span> <span class="n">second</span>
<span class="n">fbTime</span><span class="p">();</span>
<span class="n">logTimer</span><span class="p">(</span> <span class="n">IN</span> <span class="o">:=</span> <span class="n">fbTime</span><span class="o">.</span><span class="n">bValid</span> <span class="p">);</span>
<span class="n">IF</span> <span class="n">logTimer</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
   <span class="n">logTimer</span><span class="p">(</span> <span class="n">IN</span> <span class="o">:=</span> <span class="n">FALSE</span> <span class="p">);</span> <span class="n">logTimer</span><span class="p">(</span> <span class="n">IN</span> <span class="o">:=</span> <span class="n">fbTime</span><span class="o">.</span><span class="n">bValid</span> <span class="p">);</span>
   <span class="n">plcLocalTime</span> <span class="o">:=</span> <span class="n">SYSTEMTIME_TO_STRING</span><span class="p">(</span><span class="n">fbTime</span><span class="o">.</span><span class="n">systemTime</span><span class="p">);</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">make</span> <span class="n">an</span> <span class="n">info</span> <span class="n">string</span>
<span class="n">plcName</span> <span class="o">:=</span> <span class="s1">&#39;Prototype PLC: &#39;</span><span class="p">;</span>
<span class="n">plcInfo</span> <span class="o">:=</span> <span class="n">CONCAT</span><span class="p">(</span><span class="n">plcName</span><span class="p">,</span> <span class="n">plcLocalTime</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
</div>
<div class="section" id="prg-gas-selection">
<h2>PRG_Gas_Selection<a class="headerlink" href="#prg-gas-selection" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>PROGRAM PRG_Gas_Selection
VAR

    CurrentGas: E_GasType;

END_VAR
(* Gas selection includes a purge and checks interlocks*)
// Initialize the selected gas
if ( VVC_83.iq_stValve.q_xOPN_DO) then
    SelectedGas := E_GasType.Neon;
    elsif ( VVC_84.iq_stValve.q_xOPN_DO) then
            SelectedGas := E_GasType.Argon;
            elsif ( VVC_85.iq_stValve.q_xOPN_DO) then
            SelectedGas := E_GasType.Krypton;
                    elsif ( VVC_86.iq_stValve.q_xOPN_DO) then
                    SelectedGas := E_GasType.Xenon;
                    // else
                    //       SelectedGas := E_GasType.none;
END_IF

(*
If( CurrentGas &lt;&gt; SelectedGas) AND NOT (CurrentGas=E_GasType.none) then
    bStartPurge_sw := true;
END_IF

if NOT(bStartPurge_sw) AND(bPurgeDone) then
    case SelectedGas of
    E_GasType.none: // all valves closed
            VVC_83.M_Set_OPN_SW(false);
            VVC_84.M_Set_OPN_SW(false);
            VVC_85.M_Set_OPN_SW(false);
            VVC_86.M_Set_OPN_SW(false);
    E_GasType.Neon:
            VVC_83.M_Set_OPN_SW(TRUE);
            VVC_84.M_Set_OPN_SW(false);
            VVC_85.M_Set_OPN_SW(false);
            VVC_86.M_Set_OPN_SW(false);
    E_GasType.Argon:
            VVC_83.M_Set_OPN_SW(false);
            VVC_84.M_Set_OPN_SW(TRUE);
            VVC_85.M_Set_OPN_SW(false);
            VVC_86.M_Set_OPN_SW(false);
    E_GasType.Krypton:
            VVC_83.M_Set_OPN_SW(false);
            VVC_84.M_Set_OPN_SW(false);
            VVC_85.M_Set_OPN_SW(TRUE);
            VVC_86.M_Set_OPN_SW(false);
    E_GasType.Xenon:
            VVC_83.M_Set_OPN_SW(false);
            VVC_84.M_Set_OPN_SW(false);
            VVC_85.M_Set_OPN_SW(false);
            VVC_86.M_Set_OPN_SW(TRUE);
    END_CASE
END_IF
*)

/// vcn and vgp on manual or auto??

END_PROGRAM
</pre></div>
</div>
</div>
<div class="section" id="prg-gmd">
<h2>PRG_GMD<a class="headerlink" href="#prg-gmd" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_GMD</span>
<span class="n">VAR</span>
    <span class="n">f_</span><span class="p">:</span> <span class="n">INT</span><span class="p">;</span>
    <span class="n">fb_EM1K0_GMD_PTM_10i_xExtILKOk</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">FB_MKS317</span>

<span class="n">fb_EM1K0_GMD_GPI_10</span><span class="p">(</span><span class="n">PG</span><span class="o">=&gt;</span><span class="p">);</span>
<span class="n">fb_EM1K0_GMD_GPI_40</span><span class="p">(</span><span class="n">PG</span><span class="o">=&gt;</span><span class="p">);</span>
<span class="n">fb_EM1K0_GMD_GPI_70</span><span class="p">(</span><span class="n">PG</span><span class="o">=&gt;</span><span class="p">);</span>

<span class="o">//</span> <span class="n">FB_PTM_TwisTorr</span>

<span class="n">fb_EM1K0_GMD_PTM_10</span><span class="p">(</span><span class="n">i_xExtILKOk</span> <span class="o">:=</span> <span class="n">F_TurboExtILKLogic_2</span><span class="p">(</span>
    <span class="n">Turbo</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PTM_10</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span>
    <span class="n">BackingGauge</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_10</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span>
    <span class="n">InletGauge</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GCC_10</span><span class="o">.</span><span class="n">IG</span><span class="p">,</span>
    <span class="n">ScrollPump</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PRT_40</span><span class="o">.</span><span class="n">stPump</span><span class="p">));</span>
<span class="n">fb_EM1K0_GMD_PTM_20</span><span class="p">(</span><span class="n">i_xExtILKOk</span> <span class="o">:=</span>  <span class="n">F_TurboExtILKLogic_2</span><span class="p">(</span>
    <span class="n">Turbo</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PTM_20</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span>
    <span class="n">BackingGauge</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_10</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span>
    <span class="n">InletGauge</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GCC_20</span><span class="o">.</span><span class="n">IG</span><span class="p">,</span>
    <span class="n">ScrollPump</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PRT_40</span><span class="o">.</span><span class="n">stPump</span><span class="p">));</span>
<span class="n">fb_EM1K0_GMD_PTM_30</span><span class="p">(</span><span class="n">i_xExtILKOk</span> <span class="o">:=</span>  <span class="n">F_TurboExtILKLogic_2</span><span class="p">(</span>
    <span class="n">Turbo</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PTM_30</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span>
    <span class="n">BackingGauge</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_10</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span>
    <span class="n">InletGauge</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GCC_30</span><span class="o">.</span><span class="n">IG</span><span class="p">,</span>
    <span class="n">ScrollPump</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PRT_40</span><span class="o">.</span><span class="n">stPump</span><span class="p">));</span>
<span class="n">fb_EM1K0_GMD_PTM_40</span><span class="p">(</span><span class="n">i_xExtILKOk</span> <span class="o">:=</span>  <span class="n">F_TurboExtILKLogic_2</span><span class="p">(</span>
    <span class="n">Turbo</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PTM_40</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span>
    <span class="n">BackingGauge</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_10</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span>
    <span class="n">InletGauge</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_40</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span>
    <span class="n">ScrollPump</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PRT_40</span><span class="o">.</span><span class="n">stPump</span><span class="p">));</span>
<span class="n">fb_EM1K0_GMD_PTM_50</span><span class="p">(</span><span class="n">i_xExtILKOk</span> <span class="o">:=</span>  <span class="n">F_TurboExtILKLogic_2</span><span class="p">(</span>
    <span class="n">Turbo</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PTM_50</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span>
    <span class="n">BackingGauge</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_10</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span>
    <span class="n">InletGauge</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GCC_50</span><span class="o">.</span><span class="n">IG</span><span class="p">,</span>
    <span class="n">ScrollPump</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PRT_40</span><span class="o">.</span><span class="n">stPump</span><span class="p">));</span>
<span class="n">fb_EM1K0_GMD_PTM_60</span><span class="p">(</span><span class="n">i_xExtILKOk</span> <span class="o">:=</span>  <span class="n">F_TurboExtILKLogic_2</span><span class="p">(</span>
    <span class="n">Turbo</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PTM_60</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span>
    <span class="n">BackingGauge</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_10</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span>
    <span class="n">InletGauge</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GCC_60</span><span class="o">.</span><span class="n">IG</span><span class="p">,</span>
    <span class="n">ScrollPump</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PRT_40</span><span class="o">.</span><span class="n">stPump</span><span class="p">));</span>
<span class="n">fb_EM1K0_GMD_PTM_70</span><span class="p">(</span><span class="n">i_xExtILKOk</span> <span class="o">:=</span>  <span class="n">F_TurboExtILKLogic_2</span><span class="p">(</span>
    <span class="n">Turbo</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PTM_70</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span>
    <span class="n">BackingGauge</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_10</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span>
    <span class="n">InletGauge</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GCC_70</span><span class="o">.</span><span class="n">IG</span><span class="p">,</span>
    <span class="n">ScrollPump</span><span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PRT_40</span><span class="o">.</span><span class="n">stPump</span><span class="p">));</span>

<span class="o">//</span> <span class="n">FB_VRC</span>

<span class="n">fb_EM1K0_GMD_VRC_10</span><span class="p">(</span>
    <span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="n">F_TurboGateValve_Protection_ILK_local</span><span class="p">(</span>
            <span class="n">i_Turbo</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PTM_10</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span>
            <span class="n">i_stISG</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_40</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span>
            <span class="n">i_stBSG</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_10</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span>
            <span class="n">ScrollPump</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PRT_40</span><span class="o">.</span><span class="n">stPump</span>
    <span class="p">),</span>
    <span class="n">i_xOverrideMode</span> <span class="o">:=</span> <span class="n">xSystemOverrideMode</span>
<span class="p">);</span>
<span class="n">fb_EM1K0_GMD_VRC_20</span><span class="p">(</span>
    <span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="n">F_TurboGateValve_Protection_ILK_local</span><span class="p">(</span>
            <span class="n">i_Turbo</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PTM_20</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span>
            <span class="n">i_stISG</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_40</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span>
            <span class="n">i_stBSG</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_10</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span>
            <span class="n">ScrollPump</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PRT_40</span><span class="o">.</span><span class="n">stPump</span>
    <span class="p">),</span>
    <span class="n">i_xOverrideMode</span> <span class="o">:=</span> <span class="n">xSystemOverrideMode</span>
<span class="p">);</span>
<span class="n">fb_EM1K0_GMD_VRC_30</span><span class="p">(</span>
    <span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="n">F_TurboGateValve_Protection_ILK_local</span><span class="p">(</span>
            <span class="n">i_Turbo</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PTM_30</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span>
            <span class="n">i_stISG</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_40</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span>
            <span class="n">i_stBSG</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_10</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span>
            <span class="n">ScrollPump</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PRT_40</span><span class="o">.</span><span class="n">stPump</span>
    <span class="p">),</span>
    <span class="n">i_xOverrideMode</span> <span class="o">:=</span> <span class="n">xSystemOverrideMode</span>
<span class="p">);</span>
<span class="n">fb_EM1K0_GMD_VRC_50</span><span class="p">(</span>
    <span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="n">F_TurboGateValve_Protection_ILK_local</span><span class="p">(</span>
            <span class="n">i_Turbo</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PTM_50</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span>
            <span class="n">i_stISG</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_40</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span>
            <span class="n">i_stBSG</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_10</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span>
            <span class="n">ScrollPump</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PRT_40</span><span class="o">.</span><span class="n">stPump</span>
    <span class="p">),</span>
    <span class="n">i_xOverrideMode</span> <span class="o">:=</span> <span class="n">xSystemOverrideMode</span>
<span class="p">);</span>
<span class="n">fb_EM1K0_GMD_VRC_60</span><span class="p">(</span>
    <span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="n">F_TurboGateValve_Protection_ILK_local</span><span class="p">(</span>
            <span class="n">i_Turbo</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PTM_60</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span>
            <span class="n">i_stISG</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_40</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span>
            <span class="n">i_stBSG</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_10</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span>
            <span class="n">ScrollPump</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PRT_40</span><span class="o">.</span><span class="n">stPump</span>
    <span class="p">),</span>
    <span class="n">i_xOverrideMode</span> <span class="o">:=</span> <span class="n">xSystemOverrideMode</span>
<span class="p">);</span>
<span class="n">fb_EM1K0_GMD_VRC_70</span><span class="p">(</span>
    <span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="n">F_TurboGateValve_Protection_ILK_local</span><span class="p">(</span>
            <span class="n">i_Turbo</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PTM_70</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span>
            <span class="n">i_stISG</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_40</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span>
            <span class="n">i_stBSG</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_10</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span>
            <span class="n">ScrollPump</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PRT_40</span><span class="o">.</span><span class="n">stPump</span>
    <span class="p">),</span>
    <span class="n">i_xOverrideMode</span> <span class="o">:=</span> <span class="n">xSystemOverrideMode</span>
<span class="p">);</span>


<span class="o">//</span> <span class="n">FB_MKS422</span>

<span class="n">fb_EM1K0_GMD_GCC_10</span><span class="p">(</span><span class="n">PG</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_40</span><span class="o">.</span><span class="n">PG</span><span class="p">);</span>
<span class="n">fb_EM1K0_GMD_GCC_20</span><span class="p">(</span><span class="n">PG</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_40</span><span class="o">.</span><span class="n">PG</span><span class="p">);</span>
<span class="n">fb_EM1K0_GMD_GCC_30</span><span class="p">(</span><span class="n">PG</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_40</span><span class="o">.</span><span class="n">PG</span><span class="p">);</span>
<span class="n">fb_EM1K0_GMD_GCC_40</span><span class="p">(</span><span class="n">PG</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_40</span><span class="o">.</span><span class="n">PG</span><span class="p">);</span>
<span class="n">fb_EM1K0_GMD_GCC_50</span><span class="p">(</span><span class="n">PG</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_40</span><span class="o">.</span><span class="n">PG</span><span class="p">);</span>
<span class="n">fb_EM1K0_GMD_GCC_60</span><span class="p">(</span><span class="n">PG</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_40</span><span class="o">.</span><span class="n">PG</span><span class="p">);</span>
<span class="n">fb_EM1K0_GMD_GCC_70</span><span class="p">(</span><span class="n">PG</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_40</span><span class="o">.</span><span class="n">PG</span><span class="p">);</span>

<span class="o">//</span> <span class="n">FB_EbaraEVA</span>

<span class="n">fb_EM1K0_GMD_PRT_40</span><span class="p">(</span><span class="n">i_xExtIlkOK</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">);</span>

<span class="o">//</span> <span class="n">FB_VVC</span>
<span class="n">IF</span> <span class="n">bAutoVVC40</span> <span class="n">THEN</span>
    <span class="n">IF</span> <span class="n">fb_EM1K0_GMD_PRT_40</span><span class="o">.</span><span class="n">stPump</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span> <span class="n">THEN</span>
            <span class="n">fb_EM1K0_GMD_VVC_40</span><span class="o">.</span><span class="n">M_Open</span><span class="p">(</span><span class="kc">True</span><span class="p">);</span>
    <span class="n">ELSE</span>
            <span class="n">fb_EM1K0_GMD_VVC_40</span><span class="o">.</span><span class="n">M_Open</span><span class="p">(</span><span class="kc">False</span><span class="p">);</span>
    <span class="n">END_IF</span>
<span class="n">END_IF</span>

<span class="n">fb_EM1K0_GMD_VVC_40</span><span class="p">(</span>
    <span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="n">F_TURBO_PROT_SLND_ILK</span><span class="p">(</span>
        <span class="n">i_Turbo</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PTM_40</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span>
        <span class="n">i_stISG</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_40</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span>
        <span class="n">i_stBSG</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_10</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span>
        <span class="n">ScrollPump</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_PRT_40</span><span class="o">.</span><span class="n">stPump</span>
    <span class="p">),</span>
    <span class="n">i_xOverrideMode</span> <span class="o">:=</span> <span class="n">xSystemOverrideMode</span><span class="p">,</span>
<span class="p">);</span>

<span class="o">//</span> <span class="n">Roughing</span> <span class="n">valve</span>
<span class="n">IF</span><span class="p">(</span> <span class="n">fb_EM1K0_GMD_PRT_40</span><span class="o">.</span><span class="n">stPump</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpSTARTING</span> <span class="p">)</span> <span class="n">OR</span> <span class="p">(</span> <span class="n">fb_EM1K0_GMD_PRT_40</span><span class="o">.</span><span class="n">stPump</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span> <span class="p">)</span> <span class="n">THEN</span> <span class="n">fb_EM1K0_GMD_VRO_40</span><span class="o">.</span><span class="n">M_Open</span><span class="p">(</span><span class="n">TRUE</span><span class="p">);</span> <span class="n">END_IF</span>
<span class="n">fb_EM1K0_GMD_VRO_40</span><span class="p">(</span><span class="n">i_xExtILK_OK</span><span class="o">:=</span> <span class="p">(</span><span class="n">fb_EM1K0_GMD_PRT_40</span><span class="o">.</span><span class="n">stPump</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span>  <span class="n">OR</span>  <span class="n">fb_EM1K0_GMD_PRT_40</span><span class="o">.</span><span class="n">stPump</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpSTARTING</span> <span class="p">),</span> <span class="n">i_xOverrideMode</span><span class="o">:=</span> <span class="p">,</span> <span class="n">iq_stValve</span><span class="o">=&gt;</span> <span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
</div>
<div class="section" id="prg-hv-ilk">
<h2>PRG_HV_ILK<a class="headerlink" href="#prg-hv-ilk" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_HV_ILK</span>
<span class="n">VAR</span>
    <span class="n">HV_ILK_OK</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">:=</span> <span class="n">false</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span><span class="n">evaluate</span> <span class="n">the</span> <span class="n">HV</span> <span class="n">ILK_OK</span> <span class="n">bit</span>
<span class="o">//</span><span class="n">HV_ILK_OK</span> <span class="o">:=</span> <span class="n">GCC_40</span><span class="o">.</span><span class="n">IG</span><span class="o">.</span><span class="n">xAT_VAC</span><span class="p">;</span>

<span class="n">hv1</span><span class="p">(</span><span class="n">i_xExtIlkOK</span> <span class="o">:=</span> <span class="n">F_HV_ILK</span><span class="p">(</span>
    <span class="n">IG</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GCC_40</span><span class="o">.</span><span class="n">IG</span><span class="p">,</span>
    <span class="n">HV</span> <span class="o">:=</span> <span class="n">hv1</span><span class="o">.</span><span class="n">hv</span><span class="p">)</span>
<span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
</div>
<div class="section" id="prg-inj">
<h2>PRG_INJ<a class="headerlink" href="#prg-inj" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_INJ</span>
<span class="n">VAR</span>
    <span class="n">i</span><span class="p">:</span><span class="n">INT</span><span class="p">;</span>
    <span class="n">fullScale</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span><span class="mi">2000</span><span class="p">;</span>
    <span class="n">DefaultSP</span> <span class="p">:</span><span class="n">REAL</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">rFULL_SCALE</span><span class="p">:</span><span class="n">REAL</span><span class="o">:=</span><span class="mi">3000</span><span class="p">;</span><span class="o">//</span><span class="n">psig</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">GCM</span>
<span class="n">GCM_80</span><span class="p">(</span><span class="n">i_rFULL_SCALE</span> <span class="o">:=</span> <span class="n">fullScale</span> <span class="p">);</span>
<span class="n">GFM_86</span><span class="p">(</span><span class="n">i_rFULL_SCALE</span><span class="o">:=</span> <span class="n">rFULL_SCALE</span><span class="p">,</span><span class="n">rDefaultSP</span><span class="o">:=</span><span class="n">DefaultSP</span><span class="p">);</span>

<span class="n">i</span><span class="o">:=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
<span class="o">//</span> <span class="n">Vent</span> <span class="n">Valves</span>
<span class="o">//</span> <span class="n">interlock</span> <span class="n">evaluation</span>

<span class="n">VVC_80</span><span class="o">.</span><span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="p">(</span><span class="n">VCN_40</span><span class="o">.</span><span class="n">iq_stVCN</span><span class="o">.</span><span class="n">eValveControl</span> <span class="o">=</span> <span class="n">E_VCN</span><span class="o">.</span><span class="n">CloseValve</span><span class="p">)</span> <span class="n">OR</span><span class="p">(</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_81</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span><span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_82</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">));</span> <span class="o">//</span> <span class="n">we</span> <span class="n">need</span> <span class="n">to</span> <span class="n">purge</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">way</span> <span class="n">up</span> <span class="n">to</span> <span class="n">the</span> <span class="n">VCN</span>
<span class="n">VVC_81</span><span class="o">.</span><span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="p">(</span><span class="n">VVC_82</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_83</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span><span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_84</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_85</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_86</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">);</span><span class="o">//</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_80</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">);</span>
<span class="n">VVC_82</span><span class="o">.</span><span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_83</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span><span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_84</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_85</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_86</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">);</span><span class="o">//</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_80</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">);</span>

<span class="o">//</span> <span class="n">instanitation</span>
<span class="n">VVC_80</span><span class="p">(</span><span class="n">i_xExtILK_OK</span><span class="o">:=</span> <span class="p">,</span> <span class="n">i_xOverrideMode</span><span class="o">:=</span> <span class="n">xOverrideMode</span><span class="p">,</span> <span class="n">iq_stValve</span><span class="o">=&gt;</span> <span class="p">);</span>
<span class="n">VVC_81</span><span class="p">(</span><span class="n">i_xExtILK_OK</span><span class="o">:=</span> <span class="p">,</span> <span class="n">i_xOverrideMode</span><span class="o">:=</span> <span class="n">xOverrideMode</span><span class="p">,</span> <span class="n">iq_stValve</span><span class="o">=&gt;</span> <span class="p">);</span>
<span class="n">VVC_82</span><span class="p">(</span><span class="n">i_xExtILK_OK</span><span class="o">:=</span> <span class="p">,</span> <span class="n">i_xOverrideMode</span><span class="o">:=</span> <span class="n">xOverrideMode</span><span class="p">,</span> <span class="n">iq_stValve</span><span class="o">=&gt;</span> <span class="p">);</span>



<span class="o">//</span> <span class="n">Gas</span> <span class="n">panel</span>

<span class="o">//</span> <span class="n">Interlock</span> <span class="n">evaluation</span>
<span class="n">VVC_83</span><span class="o">.</span><span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_84</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_85</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_86</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_81</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_82</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">);</span> <span class="o">//</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">bPurgeActive</span>
<span class="n">VVC_84</span><span class="o">.</span><span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_83</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_85</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_86</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_81</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_82</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">);</span> <span class="o">//</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">bPurgeActive</span>
<span class="n">VVC_85</span><span class="o">.</span><span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_83</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_84</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_86</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_81</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_82</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">);</span> <span class="o">//</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">bPurgeActive</span>
<span class="n">VVC_86</span><span class="o">.</span><span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_83</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_84</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_85</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_81</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_82</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">);</span><span class="o">//</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">bPurgeActive</span>

<span class="o">//</span><span class="n">Gas</span> <span class="n">Panel</span>
<span class="n">VVC_83</span><span class="p">(</span><span class="n">i_xExtILK_OK</span><span class="o">:=</span> <span class="p">,</span> <span class="n">i_xOverrideMode</span><span class="o">:=</span> <span class="n">xOverrideMode</span><span class="p">,</span> <span class="n">iq_stValve</span><span class="o">=&gt;</span> <span class="p">);</span>
<span class="n">VVC_84</span><span class="p">(</span><span class="n">i_xExtILK_OK</span><span class="o">:=</span> <span class="p">,</span> <span class="n">i_xOverrideMode</span><span class="o">:=</span> <span class="n">xOverrideMode</span><span class="p">,</span> <span class="n">iq_stValve</span><span class="o">=&gt;</span> <span class="p">);</span>
<span class="n">VVC_85</span><span class="p">(</span><span class="n">i_xExtILK_OK</span><span class="o">:=</span> <span class="p">,</span> <span class="n">i_xOverrideMode</span><span class="o">:=</span> <span class="n">xOverrideMode</span><span class="p">,</span> <span class="n">iq_stValve</span><span class="o">=&gt;</span> <span class="p">);</span>
<span class="n">VVC_86</span><span class="p">(</span><span class="n">i_xExtILK_OK</span><span class="o">:=</span> <span class="p">,</span> <span class="n">i_xOverrideMode</span><span class="o">:=</span> <span class="n">xOverrideMode</span><span class="p">,</span> <span class="n">iq_stValve</span><span class="o">=&gt;</span> <span class="p">);</span>

<span class="n">RTD</span><span class="p">();</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
</div>
<div class="section" id="prg-pressurecontrol">
<h2>PRG_PressureControl<a class="headerlink" href="#prg-pressurecontrol" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_PressureControl</span>
<span class="n">VAR</span> <span class="n">CONSTANT</span>
            <span class="n">nDataTable_NumberOfRows</span> <span class="p">:</span> <span class="n">INT</span><span class="o">:=</span><span class="mi">9</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>

    <span class="n">fCtrlOutput</span>                                             <span class="p">:</span> <span class="n">FLOAT</span><span class="p">;</span>
    <span class="n">fBasicCtrlOutput</span>                                                <span class="p">:</span> <span class="n">FLOAT</span><span class="p">;</span>
    <span class="n">f_Rep_POS</span><span class="p">:</span> <span class="n">Float</span><span class="p">;</span>







    <span class="n">fManValue</span>                                                                                       <span class="p">:</span> <span class="n">FLOAT</span><span class="p">;</span>
    <span class="n">bExtrapolate</span>                                                                            <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">fManSyncValue</span>                   <span class="p">:</span> <span class="n">FLOAT</span><span class="p">;</span>
    <span class="n">bSync</span>                                           <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">bHold</span>                                           <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">eMode</span>                                           <span class="p">:</span> <span class="n">E_CTRL_MODE</span><span class="p">;</span>
    <span class="n">stCTRL_PID_PARAMS</span>               <span class="p">:</span> <span class="n">ST_CTRL_PID_PARAMS</span><span class="p">;</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS</span>         <span class="p">:</span> <span class="n">ST_CTRL_LIN_INTERPOLATION_PARAMS</span><span class="p">;</span>

    <span class="n">eErrorId</span>                                        <span class="p">:</span> <span class="n">E_CTRL_ERRORCODES</span><span class="p">;</span>

    <span class="n">bARWactive</span>                              <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">arrTable</span>                                                                                        <span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1.</span><span class="o">.</span><span class="n">nDataTable_NumberOfRows</span><span class="p">,</span><span class="mf">1.</span><span class="o">.</span><span class="mi">2</span><span class="p">]</span> <span class="n">OF</span> <span class="n">FLOAT</span><span class="p">;</span>
    <span class="p">(</span><span class="o">*</span> <span class="n">controller</span>  <span class="o">*</span><span class="p">)</span>
    <span class="n">fbCTRL_PID</span>                                      <span class="p">:</span> <span class="n">FB_CTRL_PID</span><span class="p">;</span>
    <span class="n">fbCTRL_Normalize</span>        <span class="p">:</span> <span class="n">FB_CTRL_NORMALIZE</span><span class="p">;</span>
    <span class="n">fbCTRL_LIN_INTERPOLATION</span>                                        <span class="p">:</span> <span class="n">FB_CTRL_LIN_INTERPOLATION</span><span class="p">;</span>

    <span class="n">bInit</span>                                           <span class="p">:</span> <span class="n">BOOL</span>          <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">FTrig</span><span class="p">:</span> <span class="n">F_TRIG</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span><span class="n">Set</span> <span class="n">VRC</span> <span class="n">upper</span> <span class="n">limit</span>
<span class="n">IF</span> <span class="n">bInit</span>
<span class="n">THEN</span>
    <span class="n">VCN_40</span><span class="o">.</span><span class="n">M_SetThrottle</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span> <span class="o">//</span> <span class="n">default</span> <span class="n">at</span> <span class="n">start</span> <span class="n">up</span><span class="p">,</span> <span class="n">should</span> <span class="n">be</span> <span class="n">overridedn</span> <span class="n">through</span> <span class="n">epics</span> <span class="n">pv</span>
<span class="n">END_IF</span>

<span class="o">//</span><span class="n">VCN</span> <span class="o">//</span><span class="n">bAdditionalVCNIlk</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">bAdditionalVCNIlk</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">VCN_40</span><span class="o">.</span><span class="n">i_xExtIlkOK</span> <span class="o">:=</span> <span class="p">(</span> <span class="n">fb_EM1K0_GMD_GCC_10</span><span class="o">.</span><span class="n">IG</span><span class="o">.</span><span class="n">xAT_VAC</span> <span class="n">AND</span>  <span class="n">fb_EM1K0_GMD_GCC_20</span><span class="o">.</span><span class="n">IG</span><span class="o">.</span><span class="n">xAT_VAC</span> <span class="n">AND</span> <span class="n">fb_EM1K0_GMD_GCC_30</span><span class="o">.</span><span class="n">IG</span><span class="o">.</span><span class="n">xAT_VAC</span> <span class="n">AND</span> <span class="n">fb_EM1K0_GMD_GCC_40</span><span class="o">.</span><span class="n">IG</span><span class="o">.</span><span class="n">xAT_VAC</span>
                                                    <span class="n">AND</span>  <span class="n">fb_EM1K0_GMD_GCC_50</span><span class="o">.</span><span class="n">IG</span><span class="o">.</span><span class="n">xAT_VAC</span> <span class="n">AND</span>  <span class="n">fb_EM1K0_GMD_GCC_60</span><span class="o">.</span><span class="n">IG</span><span class="o">.</span><span class="n">xAT_VAC</span> <span class="n">AND</span> <span class="n">fb_EM1K0_GMD_GCC_70</span><span class="o">.</span><span class="n">IG</span><span class="o">.</span><span class="n">xAT_VAC</span><span class="p">)</span>
                                                            <span class="n">AND</span>  <span class="n">fb_EM1K0_GMD_GPI_40</span><span class="o">.</span><span class="n">PG</span><span class="o">.</span><span class="n">xAT_VAC</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_81</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span><span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_82</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">);</span>
    <span class="n">ELSE</span>

            <span class="n">VCN_40</span><span class="o">.</span><span class="n">i_xExtIlkOK</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_40</span><span class="o">.</span><span class="n">PG</span><span class="o">.</span><span class="n">xAT_VAC</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_81</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span><span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_82</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">);</span>
<span class="n">END_IF</span>

<span class="o">//</span><span class="n">VCN</span>
<span class="n">VCN_40</span><span class="p">(</span><span class="n">i_xExtIlkOK</span> <span class="o">:=</span><span class="p">,</span> <span class="n">i_ReqPos</span><span class="o">:=</span> <span class="p">);</span>


<span class="p">(</span><span class="o">*</span> <span class="n">Gauge</span> <span class="n">selection</span> <span class="o">*</span><span class="p">)</span>
<span class="p">(</span><span class="o">*</span><span class="n">Assign</span> <span class="n">reading</span> <span class="n">to</span> <span class="n">psuedo</span> <span class="n">gauge</span><span class="o">*</span><span class="p">)</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">fb_EM1K0_GMD_GCC_40</span><span class="o">.</span><span class="n">IG</span><span class="o">.</span><span class="n">rPRESS</span> <span class="o">&lt;=</span><span class="mf">0.0001</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">fb_EM1K0_GMD_GCC_40</span><span class="o">.</span><span class="n">IG</span><span class="o">.</span><span class="n">rPRESS</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="n">THEN</span> <span class="n">GCP</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GCC_40</span><span class="o">.</span><span class="n">IG</span><span class="p">;</span>
                    <span class="n">ElSE</span> <span class="n">GCP</span> <span class="o">:=</span> <span class="n">fb_EM1K0_GMD_GPI_40</span><span class="o">.</span><span class="n">PG</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="p">(</span><span class="o">*-------------------------------------------------------------------*</span><span class="p">)</span>
<span class="p">(</span><span class="o">*</span>             <span class="n">PI</span> <span class="n">CONTROL</span>          <span class="o">*</span><span class="p">)</span>
<span class="p">(</span><span class="o">*-------------------------------------------------------------------*</span><span class="p">)</span>


<span class="n">IF</span> <span class="n">bInit</span>
<span class="n">THEN</span>
    <span class="p">(</span><span class="o">*</span> <span class="n">init</span> <span class="n">parameter</span> <span class="n">struct</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">stCTRL_PID_PARAMS</span><span class="o">.</span><span class="n">tCtrlCycleTime</span>                <span class="o">:=</span> <span class="n">T</span><span class="c1">#10ms;</span>
    <span class="n">stCTRL_PID_PARAMS</span><span class="o">.</span><span class="n">tTaskCycleTime</span>                <span class="o">:=</span> <span class="n">T</span><span class="c1">#10ms;</span>
    <span class="n">stCTRL_PID_PARAMS</span><span class="o">.</span><span class="n">fKp</span>                                   <span class="o">:=</span> <span class="n">fKp1</span><span class="p">;</span>                        <span class="p">(</span><span class="o">*</span> <span class="n">proportional</span> <span class="n">gain</span> <span class="n">Kp</span>                         <span class="o">*</span><span class="p">)</span>
    <span class="n">stCTRL_PID_PARAMS</span><span class="o">.</span><span class="n">tTn</span>                                   <span class="o">:=</span> <span class="n">T</span><span class="c1">#500ms;             (*  Tn                                                                  *)</span>
    <span class="n">stCTRL_PID_PARAMS</span><span class="o">.</span><span class="n">tTv</span>                                   <span class="o">:=</span> <span class="n">T</span><span class="c1">#200ms;     (*  Tv                                                                  *)</span>
    <span class="n">stCTRL_PID_PARAMS</span><span class="o">.</span><span class="n">tTd</span>                                   <span class="o">:=</span> <span class="n">T</span><span class="c1">#100ms;     (*  Td                                                                  *)</span>
    <span class="n">stCTRL_PID_PARAMS</span><span class="o">.</span><span class="n">fOutMaxLimit</span>                  <span class="o">:=</span>  <span class="mi">20</span><span class="p">;</span>                 <span class="p">(</span><span class="o">*</span> <span class="n">maximum</span> <span class="n">output</span> <span class="n">limit</span>                         <span class="o">*</span><span class="p">)</span>
    <span class="n">stCTRL_PID_PARAMS</span><span class="o">.</span><span class="n">fOutMinLimit</span>                  <span class="o">:=</span>  <span class="o">-</span><span class="mi">100</span><span class="p">;</span>                       <span class="p">(</span><span class="o">*</span> <span class="n">minimum</span> <span class="n">output</span> <span class="n">limit</span>                         <span class="o">*</span><span class="p">)</span>


    <span class="p">(</span><span class="o">*</span> <span class="n">init</span> <span class="n">array</span> <span class="k">with</span> <span class="n">the</span> <span class="n">interpolation</span> <span class="n">points</span>  <span class="o">*</span><span class="p">)</span>
    <span class="p">(</span><span class="o">*</span>      <span class="n">fIn</span>                                      <span class="o">|</span>              <span class="n">fOut</span>            <span class="o">*</span><span class="p">)</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>                     <span class="n">arrTable</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.000000265</span><span class="p">;</span>           <span class="n">arrTable</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.00000319</span><span class="p">;</span>            <span class="n">arrTable</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">15</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span>  <span class="mf">0.0000036</span><span class="p">;</span>    <span class="n">arrTable</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">17</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span>  <span class="mi">0000412</span><span class="p">;</span>      <span class="n">arrTable</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">20</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.001282</span><span class="p">;</span>              <span class="n">arrTable</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">31</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.002136</span><span class="p">;</span>              <span class="n">arrTable</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">39</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.0417</span><span class="p">;</span>        <span class="n">arrTable</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">49</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.1929</span><span class="p">;</span>        <span class="n">arrTable</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">62</span><span class="p">;</span>


    <span class="p">(</span><span class="o">*</span> <span class="n">init</span> <span class="n">parameter</span> <span class="n">struct</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS</span><span class="o">.</span><span class="n">tCtrlCycleTime</span>                                  <span class="o">:=</span> <span class="n">T</span><span class="c1">#10ms;</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS</span><span class="o">.</span><span class="n">tTaskCycleTime</span>                                  <span class="o">:=</span> <span class="n">T</span><span class="c1">#10ms;</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS</span><span class="o">.</span><span class="n">nDataTable_NumberOfRows</span>         <span class="o">:=</span> <span class="n">INT_TO_UINT</span><span class="p">(</span><span class="n">nDataTable_NumberOfRows</span><span class="p">);</span>


    <span class="p">(</span><span class="o">*</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">mode</span> <span class="n">to</span> <span class="n">ACTIVE</span> <span class="o">--&gt;</span> <span class="n">normal</span> <span class="n">operation</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">eMode</span>                                                   <span class="o">:=</span> <span class="n">eCTRL_MODE_PASSIVE</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span> <span class="n">reset</span> <span class="n">the</span> <span class="n">init</span> <span class="n">flag</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">bInit</span>                                                   <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

    <span class="p">(</span><span class="o">*</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">addresses</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS</span><span class="o">.</span><span class="n">pDataTable_ADR</span>                  <span class="o">:=</span> <span class="n">ADR</span><span class="p">(</span><span class="n">arrTable</span><span class="p">);</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS</span><span class="o">.</span><span class="n">nDataTable_SIZEOF</span>               <span class="o">:=</span> <span class="n">SIZEOF</span><span class="p">(</span><span class="n">arrTable</span><span class="p">);</span>

       <span class="n">fSetpointValue</span><span class="o">:=</span> <span class="n">LIMIT</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">fSetpointValue</span><span class="p">,</span><span class="mf">0.001</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="n">VVC_80</span><span class="o">.</span><span class="n">M_IsClosed</span><span class="p">()</span> <span class="p">)</span> <span class="n">THEN</span>
            <span class="o">//</span><span class="n">eMode</span> <span class="o">:=</span> <span class="n">eCTRL_MODE_PASSIVE</span><span class="p">;</span>
            <span class="n">fSetpointValue</span> <span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="k">if</span> <span class="p">(</span><span class="n">bGo</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">VCN_40</span><span class="o">.</span><span class="n">i_ReqPos</span><span class="o">:=</span> <span class="n">fbCTRL_PID</span><span class="o">.</span><span class="n">fOut</span> <span class="o">+</span> <span class="n">fbCTRL_LIN_INTERPOLATION</span><span class="o">.</span><span class="n">fOut</span><span class="p">;</span>
    <span class="n">IF</span> <span class="p">(</span><span class="n">bReset</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="p">(</span><span class="o">*</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">mode</span> <span class="n">to</span> <span class="n">RESET</span><span class="o">*</span><span class="p">)</span>
    <span class="n">eMode</span>                                                   <span class="o">:=</span> <span class="n">eCTRL_MODE_RESET</span>   <span class="p">;</span>
    <span class="n">VCN_40</span><span class="o">.</span><span class="n">M_ValveControl</span><span class="p">(</span><span class="n">CloseValve</span><span class="p">);</span>
    <span class="o">//</span><span class="n">bReset</span> <span class="o">:=</span> <span class="kc">False</span><span class="p">;</span>
    <span class="n">ELSE</span>
            <span class="p">(</span><span class="o">*</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">mode</span> <span class="n">to</span> <span class="n">ACTIVE</span> <span class="o">--&gt;</span> <span class="n">normal</span> <span class="n">operation</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">eMode</span>                                                   <span class="o">:=</span> <span class="n">eCTRL_MODE_ACTIVE</span>   <span class="p">;</span>
    <span class="n">VCN_40</span><span class="o">.</span><span class="n">M_ValveControl</span><span class="p">(</span><span class="n">PressureControl</span><span class="p">);</span>
    <span class="n">END_IF</span>
<span class="n">END_IF</span>
<span class="n">FTRIG</span><span class="p">(</span><span class="n">CLK</span> <span class="o">:=</span> <span class="n">bGo</span><span class="p">);</span>
<span class="n">IF</span><span class="p">(</span><span class="n">FTrig</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span><span class="n">THEN</span>
            <span class="n">eMode</span>                                                   <span class="o">:=</span> <span class="n">eCTRL_MODE_PASSIVE</span><span class="p">;</span>
            <span class="n">VCN_40</span><span class="o">.</span><span class="n">M_ValveControl</span><span class="p">(</span><span class="n">CloseValve</span><span class="p">);</span>
            <span class="n">fSetpointValue</span> <span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span>


<span class="p">(</span><span class="o">*</span> <span class="n">call</span> <span class="n">interpolation</span> <span class="n">fb</span> <span class="o">*</span><span class="p">)</span>
<span class="n">fbCTRL_LIN_INTERPOLATION</span>            <span class="p">(</span>       <span class="n">fIn</span>                                             <span class="o">:=</span> <span class="n">fSetpointValue</span><span class="p">,</span>
                                                                    <span class="n">fManValue</span>                               <span class="o">:=</span> <span class="n">fManValue</span><span class="p">,</span>
                                                                    <span class="n">bExtrapolate</span>                            <span class="o">:=</span> <span class="n">bExtrapolate</span><span class="p">,</span>
                                                                    <span class="n">stParams</span>                                <span class="o">:=</span> <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS</span><span class="p">,</span>
                                                                    <span class="n">eMode</span>                                   <span class="o">:=</span> <span class="n">eMode</span><span class="p">,</span>

                                                                    <span class="n">fOut</span>                                            <span class="o">=&gt;</span> <span class="p">,</span>
                                                                    <span class="n">eErrorId</span>                                        <span class="o">=&gt;</span> <span class="n">eErrorId</span><span class="p">,</span>
                                                                    <span class="n">bError</span>                                  <span class="o">=&gt;</span> <span class="n">bError</span>
                                                            <span class="p">);</span>

<span class="p">(</span><span class="o">*</span> <span class="n">call</span> <span class="n">controller</span> <span class="o">*</span><span class="p">)</span>
<span class="n">fbCTRL_PID</span><span class="p">(</span>         <span class="n">fSetpointValue</span>          <span class="o">:=</span> <span class="n">fSetpointValue</span><span class="p">,</span>
                                    <span class="n">fActualValue</span>            <span class="o">:=</span> <span class="n">GCP</span><span class="o">.</span><span class="n">rPRESS</span> <span class="p">,</span>
                                    <span class="n">fManSyncValue</span>   <span class="o">:=</span> <span class="p">,</span>
                                    <span class="n">bSync</span>                           <span class="o">:=</span> <span class="n">bSync</span><span class="p">,</span>
                                    <span class="n">eMode</span>                           <span class="o">:=</span> <span class="n">eMode</span><span class="p">,</span>
                                    <span class="n">bHold</span>                           <span class="o">:=</span> <span class="n">bHold</span><span class="p">,</span>
                                    <span class="n">stParams</span>                        <span class="o">:=</span> <span class="n">stCTRL_PID_PARAMS</span><span class="p">,</span>
                                    <span class="n">fOut</span>                            <span class="o">=&gt;</span> <span class="p">,</span>
                                    <span class="n">bARWactive</span>              <span class="o">=&gt;</span> <span class="n">bARWactive</span><span class="p">,</span>
                                    <span class="n">eErrorId</span>                        <span class="o">=&gt;</span> <span class="n">eErrorId</span><span class="p">,</span>
                                    <span class="n">bError</span>                          <span class="o">=&gt;</span>
                            <span class="p">);</span>


<span class="n">bError</span> <span class="o">:=</span> <span class="n">fbCTRL_PID</span><span class="o">.</span><span class="n">bError</span> <span class="n">OR</span> <span class="n">fbCTRL_LIN_INTERPOLATION</span><span class="o">.</span><span class="n">bError</span><span class="p">;</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
</div>
<div class="section" id="prg-purge">
<h2>PRG_Purge<a class="headerlink" href="#prg-purge" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_Purge</span>
<span class="n">VAR</span>
    <span class="n">step</span><span class="p">:</span> <span class="n">INT</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">EM1K0</span><span class="p">:</span><span class="n">GMD</span><span class="p">:</span><span class="n">sPURGE</span>
    <span class="s1">&#39;}</span>
    <span class="n">sMessage</span> <span class="p">:</span> <span class="n">STRING</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">EM1K0</span><span class="p">:</span><span class="n">GMD</span><span class="p">:</span><span class="n">RESET</span>
    <span class="s1">&#39;}</span>
    <span class="n">bReset</span><span class="p">:</span><span class="n">BOOL</span> <span class="o">:=</span> <span class="kc">False</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">EM1K0</span><span class="p">:</span><span class="n">GMD</span><span class="p">:</span><span class="n">PurgeError</span>
    <span class="s1">&#39;}</span>
    <span class="n">bError</span><span class="p">:</span><span class="n">BOOL</span> <span class="o">:=</span> <span class="kc">False</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:PURGE:SP1;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">HOPR</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">LOPR</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">PREC</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">EGU</span> <span class="s2">&quot;TORR&quot;</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rPurge_SP1</span> <span class="p">:</span><span class="n">REAL</span> <span class="o">:=</span><span class="mf">0.01</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:PURGE:SP2;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">HOPR</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">LOPR</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">PREC</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">EGU</span> <span class="s2">&quot;TORR&quot;</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rPurge_SP2</span> <span class="p">:</span><span class="n">REAL</span> <span class="o">:=</span><span class="mf">0.1</span><span class="p">;</span>


    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: EM1K0:GMD:PURGE:REPEAT;</span>
    <span class="s1">&#39;}</span>
    <span class="n">NeedlePurgeRepeat</span>       <span class="p">:</span> <span class="n">INT</span><span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">NeedleVlvPurgeTmr</span>       <span class="p">:</span> <span class="n">TON</span><span class="p">;</span>  <span class="p">(</span><span class="o">*</span> <span class="n">Declaration</span> <span class="k">for</span> <span class="n">the</span> <span class="n">needle</span> <span class="n">valve</span> <span class="n">Purge</span> <span class="n">timer</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">tNeedlePurgeTime</span>                <span class="p">:</span> <span class="n">TIME</span><span class="o">:=</span><span class="n">T</span><span class="c1">#5S;</span>
    <span class="n">NeedlePurgeTime</span>         <span class="p">:</span> <span class="n">TIME</span><span class="o">:=</span><span class="n">T</span><span class="c1">#5S;</span>
    <span class="n">BurpET</span>                          <span class="p">:</span> <span class="n">TIME</span><span class="p">;</span>
    <span class="n">NeedlePurgeRun</span>          <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">NeedlePurgeDone</span>         <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">VCN_Timer</span>       <span class="p">:</span><span class="n">TON</span><span class="p">;</span>


    <span class="n">rt_reset</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">Timers</span>
    <span class="n">VVC_81_Timer</span> <span class="p">:</span> <span class="n">TON</span><span class="p">;</span>
    <span class="n">VVC_82_Timer</span> <span class="p">:</span> <span class="n">TON</span><span class="p">;</span>
    <span class="n">VVC_81_Time</span>                     <span class="p">:</span> <span class="n">TIME</span><span class="o">:=</span><span class="n">T</span><span class="c1">#5S;</span>
    <span class="n">VVC_82_Time</span>                     <span class="p">:</span> <span class="n">TIME</span><span class="o">:=</span><span class="n">T</span><span class="c1">#5S;</span>
    <span class="n">VCN_Time</span> <span class="p">:</span> <span class="n">TIME</span> <span class="o">:=</span> <span class="n">T</span><span class="c1">#5S;</span>

    <span class="n">iVGP_POS</span><span class="p">:</span> <span class="n">REAL</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>


<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span>
<span class="n">PURGE</span> <span class="n">CYCLE</span>
<span class="n">The</span> <span class="n">purge</span> <span class="n">cycle</span> <span class="n">consists</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">steps</span><span class="p">;</span>
<span class="mf">1.</span> <span class="n">Close</span> <span class="nb">all</span> <span class="n">gas</span> <span class="n">valves</span> <span class="mi">83</span><span class="o">-</span><span class="mi">86</span> <span class="ow">and</span> <span class="n">Close</span> <span class="n">Needle</span> <span class="n">valve</span> <span class="ow">and</span> <span class="n">switch</span> <span class="n">off</span> <span class="n">PID</span> <span class="n">control</span>
<span class="mf">2.</span> <span class="n">Wait</span> <span class="n">till</span> <span class="n">needle</span> <span class="n">valve</span> <span class="n">closes</span>
<span class="mf">3.</span> <span class="n">Close</span> <span class="n">VGP</span><span class="p">,</span> <span class="n">to</span> <span class="n">protect</span> <span class="n">the</span> <span class="n">Detector</span> <span class="n">chamber</span> <span class="ow">in</span> <span class="n">case</span> <span class="n">a</span> <span class="n">pressure</span> <span class="n">spike</span> <span class="n">on</span> <span class="n">the</span> <span class="n">roughing</span> <span class="n">line</span> <span class="n">stops</span> <span class="n">the</span> <span class="n">turbo</span><span class="o">.</span>
<span class="mf">4.</span> <span class="n">PUMP</span> <span class="n">DOWN</span> <span class="n">MANIFOLD</span><span class="p">:</span> <span class="n">Open</span> <span class="n">VVC</span><span class="o">-</span><span class="mi">80</span>  <span class="n">then</span> <span class="n">Open</span> <span class="n">VVC82</span> <span class="k">for</span> <span class="n">certain</span> <span class="n">pressure</span> <span class="n">on</span> <span class="n">the</span> <span class="n">baratron</span>
<span class="mf">5.</span> <span class="n">Open</span> <span class="n">VIC</span><span class="p">:</span><span class="mi">81</span> <span class="ow">and</span> <span class="n">keep</span> <span class="n">it</span> <span class="nb">open</span> <span class="k">while</span> <span class="n">the</span> <span class="n">manifold</span> <span class="n">pumps</span> <span class="n">down</span> <span class="n">to</span> <span class="n">pressure</span> <span class="nb">set</span> <span class="n">point</span> <span class="k">for</span> <span class="n">a</span> <span class="n">certain</span> <span class="n">time</span> <span class="n">to</span> <span class="n">avoid</span> <span class="n">flukes</span> <span class="n">then</span> <span class="n">close</span> <span class="n">VVC</span><span class="o">-</span><span class="mi">80</span>
 <span class="o">-</span> <span class="n">THEN</span> <span class="n">Fully</span> <span class="nb">open</span> <span class="n">VGP</span><span class="p">:</span><span class="mi">40</span>
<span class="mf">6.</span> <span class="n">BURP</span> <span class="n">NEEDLE</span> <span class="n">VALVE</span><span class="p">:</span> <span class="n">Once</span> <span class="n">the</span> <span class="n">manifold</span> <span class="ow">is</span> <span class="n">pumped</span> <span class="n">down</span><span class="p">,</span> <span class="nb">open</span> <span class="n">the</span> <span class="n">needle</span> <span class="n">valve</span> <span class="p">(</span><span class="n">burp</span><span class="p">)</span> <span class="n">to</span> <span class="n">evacuate</span> <span class="n">gases</span> <span class="n">that</span> <span class="n">may</span> <span class="n">be</span> <span class="n">trapped</span> <span class="ow">in</span> <span class="n">its</span> <span class="n">mechanism</span>
<span class="o">-</span> <span class="n">this</span> <span class="n">step</span> <span class="ow">is</span> <span class="n">done</span> <span class="n">gradually</span> <span class="n">to</span> <span class="n">avoid</span> <span class="n">sending</span> <span class="n">pressure</span> <span class="n">spike</span> <span class="n">into</span> <span class="n">the</span> <span class="n">detector</span>
<span class="mf">7.</span> <span class="n">Close</span> <span class="n">needle</span> <span class="n">valve</span>
<span class="mf">8.</span> <span class="n">Release</span> <span class="n">VGP</span><span class="p">:</span><span class="mi">40</span>

<span class="o">*</span><span class="p">)</span>


<span class="n">CASE</span> <span class="n">step</span> <span class="n">OF</span>
            <span class="mi">0</span><span class="p">:</span> <span class="o">//</span> <span class="n">READY</span> <span class="n">STATE</span>
            <span class="n">sMessage</span><span class="o">:=</span> <span class="s1">&#39;Purge Ready&#39;</span><span class="p">;</span>
            <span class="n">bError</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
            <span class="n">bPurgeActive</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">IF</span> <span class="p">(</span><span class="n">bStartPurge_sw</span><span class="p">)</span> <span class="n">Then</span>
                    <span class="n">step</span><span class="o">:=</span><span class="mi">10</span><span class="p">;</span>
                    <span class="n">bGo</span> <span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
                    <span class="n">bPurgeActive</span> <span class="o">:=</span> <span class="n">true</span><span class="p">;</span>
                    <span class="n">bPurgeDone</span> <span class="o">:=</span> <span class="n">false</span><span class="p">;</span>
                    <span class="n">iVGP_POS</span> <span class="o">:=</span> <span class="n">VGP_40</span><span class="o">.</span><span class="n">q_stVGP</span><span class="o">.</span><span class="n">rReqPosition</span><span class="p">;</span>
                    <span class="n">sMessage</span><span class="o">:=</span> <span class="s1">&#39;Purge Start&#39;</span><span class="p">;</span>
            <span class="n">END_IF</span>

<span class="mi">10</span><span class="p">:</span> <span class="o">//</span> <span class="n">start</span> <span class="n">purge</span> <span class="n">sequence</span> <span class="n">by</span> <span class="n">closing</span> <span class="nb">all</span> <span class="n">gas</span> <span class="n">valves</span> <span class="ow">and</span> <span class="n">needle</span> <span class="n">valve</span>
    <span class="n">VVC_80</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">FALSE</span><span class="p">);</span>
    <span class="n">VVC_81</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">FALSE</span><span class="p">);</span>
    <span class="n">VVC_82</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">FALSE</span><span class="p">);</span>
    <span class="n">VVC_83</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">FALSE</span><span class="p">);</span>
    <span class="n">VVC_84</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">FALSE</span><span class="p">);</span>
    <span class="n">VVC_85</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">FALSE</span><span class="p">);</span>
    <span class="n">VVC_86</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">FALSE</span><span class="p">);</span>
    <span class="n">VCN_40</span><span class="o">.</span><span class="n">M_ValveControl</span><span class="p">(</span><span class="n">E_VCN</span><span class="o">.</span><span class="n">CloseValve</span><span class="p">);</span>
    <span class="n">IF</span>   <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_80</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_81</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span>  <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_82</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span>
                    <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_83</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_84</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_85</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_86</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">step</span><span class="o">:=</span> <span class="mi">20</span><span class="p">;</span>
            <span class="n">sMessage</span><span class="o">:=</span> <span class="s1">&#39;Prep: All valves are closed&#39;</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">20</span><span class="p">:</span> <span class="o">//</span><span class="n">Close</span> <span class="n">Needle</span> <span class="n">valve</span>
    <span class="n">VCN_40</span><span class="o">.</span><span class="n">M_ValveControl</span><span class="p">(</span> <span class="n">E_VCN</span><span class="o">.</span><span class="n">CloseValve</span><span class="p">);</span>
    <span class="o">//</span> <span class="n">wait</span> <span class="k">for</span> <span class="n">a</span> <span class="n">period</span> <span class="n">of</span> <span class="n">time</span> <span class="n">to</span> <span class="n">ensure</span> <span class="n">that</span> <span class="n">the</span> <span class="n">Valve</span> <span class="ow">is</span> <span class="n">fully</span> <span class="n">closed</span>
    <span class="n">IF</span> <span class="p">(</span><span class="n">VCN_Timer</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">30</span><span class="p">;</span>
            <span class="n">sMessage</span><span class="o">:=</span> <span class="s1">&#39;Prep: Needle Valve is closed&#39;</span><span class="p">;</span>
    <span class="n">END_IF</span>


<span class="mi">30</span><span class="p">:</span> <span class="o">//</span><span class="n">Fully</span> <span class="n">close</span> <span class="n">VGP</span><span class="p">:</span><span class="mi">40</span>
    <span class="n">VGP_40</span><span class="o">.</span><span class="n">M_ValveControl</span><span class="p">(</span><span class="n">E_VCN</span><span class="o">.</span><span class="n">CloseValve</span><span class="p">);</span>
    <span class="n">VGP_40</span><span class="o">.</span><span class="n">M_SetGoSw</span><span class="p">(</span><span class="n">TRUE</span><span class="p">);</span>
    <span class="n">IF</span> <span class="n">NOT</span><span class="p">(</span><span class="n">VGP_40</span><span class="o">.</span><span class="n">q_stVGP</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">E_MoveState</span><span class="o">.</span><span class="n">READY</span><span class="p">)</span><span class="n">THEN</span> <span class="o">//</span> <span class="n">wait</span> <span class="n">until</span> <span class="n">the</span> <span class="n">VGP</span> <span class="n">Starts</span> <span class="n">moving</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">31</span><span class="p">;</span>
            <span class="n">sMessage</span><span class="o">:=</span> <span class="s1">&#39;Prep: VGP to fully closed&#39;</span><span class="p">;</span>
    <span class="n">END_IF</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">VGP_40</span><span class="o">.</span><span class="n">q_stVGP</span><span class="o">.</span><span class="n">pv_xError</span> <span class="p">)</span> <span class="n">OR</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">VGP_40</span><span class="o">.</span><span class="n">i_xExtIlkOK</span><span class="p">)</span> <span class="n">OR</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">VGP_40</span><span class="o">.</span><span class="n">q_stVGP</span><span class="o">.</span><span class="n">pv_xHomed</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">900</span><span class="o">+</span><span class="n">step</span><span class="p">;</span>
    <span class="n">END_IF</span>
<span class="mi">31</span><span class="p">:</span>
    <span class="n">IF</span> <span class="p">(</span><span class="n">VGP_40</span><span class="o">.</span><span class="n">q_stVGP</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">E_MoveState</span><span class="o">.</span><span class="n">READY</span> <span class="p">)</span> <span class="n">THEN</span> <span class="o">//</span> <span class="n">wait</span> <span class="n">until</span> <span class="n">the</span> <span class="n">VGP</span> <span class="n">motion</span> <span class="ow">is</span> <span class="n">done</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">40</span><span class="p">;</span>
            <span class="n">sMessage</span><span class="o">:=</span> <span class="s1">&#39;Prep: VGP is closed&#39;</span><span class="p">;</span>
    <span class="n">END_IF</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">VGP_40</span><span class="o">.</span><span class="n">q_stVGP</span><span class="o">.</span><span class="n">pv_xError</span> <span class="p">)</span><span class="n">then</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">900</span><span class="o">+</span><span class="n">step</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">40</span><span class="p">:</span> <span class="o">//</span> <span class="nb">open</span> <span class="n">vavle</span> <span class="mi">80</span> <span class="n">to</span> <span class="n">pump</span> <span class="n">down</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">way</span> <span class="n">to</span> <span class="n">the</span> <span class="n">needle</span> <span class="n">valve</span>
    <span class="n">VVC_80</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">TRUE</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">VVC_80</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span> <span class="p">)</span> <span class="n">THEN</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">41</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">41</span><span class="p">:</span> <span class="o">//</span><span class="n">PUMP</span> <span class="n">DOWN</span> <span class="n">MANIFOLD</span><span class="p">:</span> <span class="n">Open</span> <span class="n">VIC82</span> <span class="k">for</span> <span class="n">a</span> <span class="n">certain</span> <span class="n">peroid</span> <span class="n">of</span> <span class="n">time</span> <span class="ow">or</span> <span class="n">till</span> <span class="n">certain</span> <span class="n">pressure</span>
    <span class="n">VVC_82</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">TRUE</span><span class="p">);</span>
    <span class="n">sMessage</span><span class="o">:=</span> <span class="s1">&#39;Pumping down: VVC80 and VVC82 are open&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">VVC_82</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">VVC_82_Timer</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">GCM_80</span><span class="o">.</span><span class="n">PG</span><span class="o">.</span><span class="n">rPRESS</span> <span class="o">&lt;=</span> <span class="n">rPurge_SP1</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">50</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">50</span><span class="p">:</span><span class="o">//</span> <span class="n">Open</span> <span class="n">VIC</span><span class="p">:</span><span class="mi">81</span> <span class="ow">and</span> <span class="n">keep</span> <span class="n">it</span> <span class="nb">open</span> <span class="k">while</span> <span class="n">the</span> <span class="n">manifold</span> <span class="n">pumps</span> <span class="n">down</span> <span class="n">to</span> <span class="n">pressure</span> <span class="nb">set</span> <span class="n">point</span>
    <span class="n">VVC_81</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">TRUE</span><span class="p">);</span>
    <span class="n">sMessage</span><span class="o">:=</span> <span class="s1">&#39;Pumping down: VVC80, VVC81 and VVC82 are open&#39;</span><span class="p">;</span>
    <span class="n">IF</span> <span class="p">(</span><span class="n">VVC_81</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span> <span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">VVC_81_Timer</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">GCM_80</span><span class="o">.</span><span class="n">PG</span><span class="o">.</span><span class="n">rPRESS</span> <span class="o">&lt;=</span> <span class="n">rPurge_SP2</span><span class="p">)</span> <span class="n">THEN</span> <span class="o">//</span> <span class="ow">or</span> <span class="n">a</span> <span class="n">certain</span> <span class="n">pressure</span> <span class="n">reading</span> <span class="ow">and</span> <span class="n">check</span> <span class="n">timeouts</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">51</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">51</span><span class="p">:</span> <span class="o">//</span><span class="n">Close</span> <span class="n">VIC</span><span class="p">:</span><span class="mi">81</span> <span class="ow">and</span> <span class="n">VIC</span><span class="p">:</span><span class="mi">82</span>
    <span class="n">VVC_80</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
    <span class="n">VVC_81</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
    <span class="n">VVC_82</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
    <span class="n">sMessage</span><span class="o">:=</span> <span class="s1">&#39;Pumping down complete: valves are closed&#39;</span><span class="p">;</span>
    <span class="n">IF</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_80</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span><span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_81</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">AND</span><span class="p">(</span><span class="n">NOT</span> <span class="n">VVC_82</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">q_xOPN_DO</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">55</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">55</span><span class="p">:</span> <span class="o">//</span><span class="n">Fully</span> <span class="n">close</span> <span class="n">VGP</span>
    <span class="n">VGP_40</span><span class="o">.</span><span class="n">M_ValveControl</span><span class="p">(</span><span class="n">E_VCN</span><span class="o">.</span><span class="n">OpenValve</span><span class="p">);</span>
    <span class="n">IF</span> <span class="n">NOT</span><span class="p">(</span><span class="n">VGP_40</span><span class="o">.</span><span class="n">q_stVGP</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">E_MoveState</span><span class="o">.</span><span class="n">READY</span> <span class="p">)</span> <span class="n">THEN</span> <span class="o">//</span> <span class="n">wait</span> <span class="n">until</span> <span class="n">the</span> <span class="n">VGP</span> <span class="n">Starts</span> <span class="n">moving</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">56</span><span class="p">;</span>
            <span class="n">sMessage</span><span class="o">:=</span> <span class="s1">&#39;Prep: VGP to fully open&#39;</span><span class="p">;</span>
    <span class="n">END_IF</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">VGP_40</span><span class="o">.</span><span class="n">q_stVGP</span><span class="o">.</span><span class="n">pv_xError</span> <span class="p">)</span> <span class="n">OR</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">VGP_40</span><span class="o">.</span><span class="n">i_xExtIlkOK</span><span class="p">)</span> <span class="n">OR</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">VGP_40</span><span class="o">.</span><span class="n">q_stVGP</span><span class="o">.</span><span class="n">pv_xHomed</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">900</span><span class="o">+</span><span class="n">step</span><span class="p">;</span>
    <span class="n">END_IF</span>
<span class="mi">56</span><span class="p">:</span>
    <span class="n">IF</span> <span class="p">(</span><span class="n">VGP_40</span><span class="o">.</span><span class="n">q_stVGP</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">E_MoveState</span><span class="o">.</span><span class="n">READY</span> <span class="p">)</span> <span class="n">THEN</span> <span class="o">//</span> <span class="n">wait</span> <span class="n">until</span> <span class="n">the</span> <span class="n">VGP</span> <span class="n">motion</span> <span class="ow">is</span> <span class="n">done</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">60</span><span class="p">;</span>
            <span class="n">sMessage</span><span class="o">:=</span> <span class="s1">&#39;Prep: VGP is Open&#39;</span><span class="p">;</span>
    <span class="n">END_IF</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">VGP_40</span><span class="o">.</span><span class="n">q_stVGP</span><span class="o">.</span><span class="n">pv_xError</span> <span class="p">)</span><span class="n">then</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">900</span><span class="o">+</span><span class="n">step</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">60</span><span class="p">:</span> <span class="o">//</span><span class="n">BURP</span> <span class="n">NEEDLE</span> <span class="n">VALVE</span><span class="p">:</span> <span class="n">Once</span> <span class="n">the</span> <span class="n">manifold</span> <span class="ow">is</span> <span class="n">pumped</span> <span class="n">down</span><span class="p">,</span> <span class="nb">open</span> <span class="n">the</span> <span class="n">needle</span> <span class="n">valve</span> <span class="p">(</span><span class="n">burp</span><span class="p">)</span> <span class="n">to</span> <span class="n">evacuate</span> <span class="n">gases</span> <span class="n">that</span> <span class="n">may</span> <span class="n">be</span> <span class="n">trapped</span> <span class="ow">in</span> <span class="n">its</span> <span class="n">mechanism</span>
    <span class="n">VCN_40</span><span class="o">.</span><span class="n">M_ValveControl</span><span class="p">(</span><span class="n">E_VCN</span><span class="o">.</span><span class="n">PressureControl</span><span class="p">);</span>
    <span class="n">VCN_40</span><span class="o">.</span><span class="n">i_ReqPos</span> <span class="o">:=</span> <span class="mi">15</span><span class="p">;</span>
    <span class="n">sMessage</span><span class="o">:=</span> <span class="s1">&#39;VCN Burp: VCN to 15%&#39;</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">wait</span> <span class="k">for</span> <span class="n">a</span> <span class="n">period</span> <span class="n">of</span> <span class="n">time</span> <span class="n">to</span> <span class="n">ensure</span> <span class="n">that</span> <span class="n">the</span> <span class="n">Valve</span> <span class="ow">is</span> <span class="n">fully</span> <span class="n">closed</span>
    <span class="n">IF</span> <span class="p">(</span><span class="n">NeedleVlvPurgeTmr</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">61</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">61</span><span class="p">:</span>
    <span class="n">VCN_40</span><span class="o">.</span><span class="n">i_ReqPos</span> <span class="o">:=</span> <span class="mi">19</span><span class="p">;</span>
    <span class="n">sMessage</span><span class="o">:=</span> <span class="s1">&#39;VCN Burp: VCN to 19%&#39;</span><span class="p">;</span>
    <span class="n">IF</span> <span class="p">(</span><span class="n">VCN_Timer</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">62</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">62</span><span class="p">:</span> <span class="o">//</span><span class="n">BURP</span> <span class="n">NEEDLE</span> <span class="n">VALVE</span><span class="p">:</span> <span class="n">Once</span> <span class="n">the</span> <span class="n">manifold</span> <span class="ow">is</span> <span class="n">pumped</span> <span class="n">down</span><span class="p">,</span> <span class="nb">open</span> <span class="n">the</span> <span class="n">needle</span> <span class="n">valve</span> <span class="p">(</span><span class="n">burp</span><span class="p">)</span> <span class="n">to</span> <span class="n">evacuate</span> <span class="n">gases</span> <span class="n">that</span> <span class="n">may</span> <span class="n">be</span> <span class="n">trapped</span> <span class="ow">in</span> <span class="n">its</span> <span class="n">mechanism</span>
    <span class="n">VCN_40</span><span class="o">.</span><span class="n">i_ReqPos</span> <span class="o">:=</span> <span class="mi">25</span><span class="p">;</span>
    <span class="n">sMessage</span><span class="o">:=</span> <span class="s1">&#39;VCN Burp: VCN to 25%&#39;</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">wait</span> <span class="k">for</span> <span class="n">a</span> <span class="n">period</span> <span class="n">of</span> <span class="n">time</span> <span class="n">to</span> <span class="n">ensure</span> <span class="n">that</span> <span class="n">the</span> <span class="n">Valve</span> <span class="ow">is</span> <span class="n">fully</span> <span class="n">closed</span>
    <span class="n">IF</span> <span class="p">(</span><span class="n">NeedleVlvPurgeTmr</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">63</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">63</span><span class="p">:</span>
    <span class="n">VCN_40</span><span class="o">.</span><span class="n">i_ReqPos</span> <span class="o">:=</span> <span class="mi">31</span><span class="p">;</span>
    <span class="n">sMessage</span><span class="o">:=</span> <span class="s1">&#39;VCN Burp: VCN to 31%&#39;</span><span class="p">;</span>
    <span class="n">IF</span> <span class="p">(</span><span class="n">VCN_Timer</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">64</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">64</span><span class="p">:</span>
    <span class="n">VCN_40</span><span class="o">.</span><span class="n">i_ReqPos</span> <span class="o">:=</span> <span class="mi">39</span><span class="p">;</span>
    <span class="n">sMessage</span><span class="o">:=</span> <span class="s1">&#39;VCN Burp: VCN to 39%&#39;</span><span class="p">;</span>
    <span class="n">IF</span> <span class="p">(</span><span class="n">NeedleVlvPurgeTmr</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">65</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">65</span><span class="p">:</span>
    <span class="n">VCN_40</span><span class="o">.</span><span class="n">i_ReqPos</span> <span class="o">:=</span> <span class="mi">49</span><span class="p">;</span>
    <span class="n">sMessage</span><span class="o">:=</span> <span class="s1">&#39;VCN Burp: VCN to 49%&#39;</span><span class="p">;</span>
    <span class="n">IF</span> <span class="p">(</span><span class="n">VCN_Timer</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">66</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">66</span><span class="p">:</span>
    <span class="n">VCN_40</span><span class="o">.</span><span class="n">i_ReqPos</span> <span class="o">:=</span> <span class="mi">62</span><span class="p">;</span>
    <span class="n">sMessage</span><span class="o">:=</span> <span class="s1">&#39;VCN Burp: VCN to 62%&#39;</span><span class="p">;</span>
    <span class="n">IF</span> <span class="p">(</span><span class="n">NeedleVlvPurgeTmr</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">67</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">67</span><span class="p">:</span>
    <span class="n">VCN_40</span><span class="o">.</span><span class="n">i_ReqPos</span> <span class="o">:=</span> <span class="mi">78</span><span class="p">;</span>
    <span class="n">sMessage</span><span class="o">:=</span> <span class="s1">&#39;VCN Burp: VCN to 78%&#39;</span><span class="p">;</span>
    <span class="n">IF</span> <span class="p">(</span><span class="n">VCN_Timer</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">68</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">68</span><span class="p">:</span>
    <span class="n">VCN_40</span><span class="o">.</span><span class="n">i_ReqPos</span> <span class="o">:=</span> <span class="mi">100</span><span class="p">;</span>
    <span class="n">sMessage</span><span class="o">:=</span> <span class="s1">&#39;VCN Burp: VCN to 100%&#39;</span><span class="p">;</span>
    <span class="n">IF</span> <span class="p">(</span><span class="n">NeedleVlvPurgeTmr</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">70</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">70</span><span class="p">:</span> <span class="o">//</span><span class="n">Close</span> <span class="n">Needle</span> <span class="n">valve</span>
    <span class="n">VCN_40</span><span class="o">.</span><span class="n">M_ValveControl</span><span class="p">(</span><span class="n">E_VCN</span><span class="o">.</span><span class="n">CloseValve</span><span class="p">);</span>
    <span class="n">sMessage</span><span class="o">:=</span> <span class="s1">&#39;VCN Burp Complete: VCN to 0%&#39;</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">wait</span> <span class="k">for</span> <span class="n">a</span> <span class="n">period</span> <span class="n">of</span> <span class="n">time</span> <span class="n">to</span> <span class="n">ensure</span> <span class="n">that</span> <span class="n">the</span> <span class="n">Valve</span> <span class="ow">is</span> <span class="n">fully</span> <span class="n">closed</span>
    <span class="n">IF</span> <span class="p">(</span><span class="n">VCN_Timer</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">80</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">80</span><span class="p">:</span> <span class="o">//</span> <span class="n">Repeat</span>
    <span class="n">IF</span> <span class="p">(</span><span class="n">NeedlePurgeRepeat</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">NeedlePurgeRepeat</span> <span class="o">:=</span> <span class="n">NeedlePurgeRepeat</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">step</span><span class="o">:=</span> <span class="mi">60</span><span class="p">;</span>
    <span class="n">ELSE</span>
            <span class="n">NeedlePurgeRepeat</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">90</span><span class="p">;</span>
    <span class="n">END_IF</span>


<span class="mi">90</span><span class="p">:</span> <span class="o">//</span><span class="n">Release</span> <span class="n">VGP</span><span class="p">:</span><span class="mi">40</span>
    <span class="n">VGP_40</span><span class="o">.</span><span class="n">M_ValveControl</span><span class="p">(</span><span class="n">E_VCN</span><span class="o">.</span><span class="n">ManualControl</span><span class="p">);</span>
    <span class="n">VGP_40</span><span class="o">.</span><span class="n">i_ReqPos</span><span class="o">:=</span> <span class="n">iVGP_POS</span><span class="p">;</span> <span class="o">//</span><span class="mi">50</span><span class="o">%</span> <span class="nb">open</span>
    <span class="n">VGP_40</span><span class="o">.</span><span class="n">M_SetGoSw</span><span class="p">(</span><span class="n">TRUE</span><span class="p">);</span>
    <span class="n">sMessage</span><span class="o">:=</span> <span class="s1">&#39;Post: VGP to previous position&#39;</span><span class="p">;</span>
    <span class="n">IF</span> <span class="n">NOT</span><span class="p">(</span><span class="n">VGP_40</span><span class="o">.</span><span class="n">q_stVGP</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">E_MoveState</span><span class="o">.</span><span class="n">READY</span> <span class="p">)</span> <span class="n">THEN</span> <span class="o">//</span> <span class="n">wait</span> <span class="n">until</span> <span class="n">the</span> <span class="n">VGP</span> <span class="n">encoder</span> <span class="n">reads</span> <span class="n">Open</span> <span class="o">//</span><span class="n">use</span> <span class="n">motion</span> <span class="n">ready</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">91</span><span class="p">;</span>
    <span class="n">END_IF</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">VGP_40</span><span class="o">.</span><span class="n">q_stVGP</span><span class="o">.</span><span class="n">pv_xError</span> <span class="p">)</span><span class="n">then</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">900</span><span class="o">+</span><span class="n">step</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">91</span><span class="p">:</span>
    <span class="n">IF</span> <span class="p">(</span><span class="n">VGP_40</span><span class="o">.</span><span class="n">q_stVGP</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">E_MoveState</span><span class="o">.</span><span class="n">READY</span> <span class="p">)</span> <span class="n">THEN</span> <span class="o">//</span> <span class="n">wait</span> <span class="n">until</span> <span class="n">the</span> <span class="n">VGP</span> <span class="n">encoder</span> <span class="n">reads</span> <span class="n">Open</span> <span class="o">//</span><span class="n">use</span> <span class="n">motion</span> <span class="n">ready</span>
            <span class="n">VGP_40</span><span class="o">.</span><span class="n">M_ValveControl</span><span class="p">(</span><span class="n">E_VCN</span><span class="o">.</span><span class="n">ManualControl</span><span class="p">);</span>
            <span class="n">VGP_40</span><span class="o">.</span><span class="n">i_ReqPos</span><span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">VGP_40</span><span class="o">.</span><span class="n">M_SetGoSw</span><span class="p">(</span><span class="n">FALSE</span><span class="p">);</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">100</span><span class="p">;</span>
            <span class="n">sMessage</span><span class="o">:=</span> <span class="s1">&#39;Purge Complete&#39;</span><span class="p">;</span>
    <span class="n">END_IF</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">VGP_40</span><span class="o">.</span><span class="n">q_stVGP</span><span class="o">.</span><span class="n">pv_xError</span> <span class="p">)</span><span class="n">then</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">900</span><span class="o">+</span><span class="n">step</span><span class="p">;</span>
    <span class="n">END_IF</span>

<span class="mi">100</span><span class="p">:</span> <span class="o">//</span> <span class="n">DONE</span>
    <span class="n">bStartPurge_sw</span> <span class="o">:=</span> <span class="n">false</span><span class="p">;</span>
    <span class="n">bPurgeActive</span> <span class="o">:=</span> <span class="n">false</span><span class="p">;</span>
    <span class="n">bPurgeDone</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">VVC_80</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
    <span class="n">VVC_81</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
    <span class="n">VVC_82</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
    <span class="n">VVC_83</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
    <span class="n">VVC_84</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
    <span class="n">VVC_85</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
    <span class="n">VVC_86</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
    <span class="n">VCN_40</span><span class="o">.</span><span class="n">M_ValveControl</span><span class="p">(</span><span class="n">E_VCN</span><span class="o">.</span><span class="n">CloseValve</span><span class="p">);</span>
    <span class="n">VGP_40</span><span class="o">.</span><span class="n">M_ValveControl</span><span class="p">(</span><span class="n">E_VCN</span><span class="o">.</span><span class="n">ManualControl</span><span class="p">);</span>
    <span class="o">//</span> <span class="n">reset</span> <span class="n">selected</span> <span class="n">gas</span> <span class="n">to</span> <span class="n">none</span>
    <span class="n">SelectedGas</span> <span class="o">:=</span> <span class="n">E_GasType</span><span class="o">.</span><span class="n">none</span><span class="p">;</span>
    <span class="n">step</span> <span class="o">:=</span><span class="mi">0</span><span class="p">;</span>

<span class="mi">900</span><span class="p">:</span> <span class="o">//</span><span class="n">Error</span>
    <span class="n">bStartPurge_sw</span> <span class="o">:=</span> <span class="n">false</span><span class="p">;</span>
    <span class="n">bPurgeActive</span> <span class="o">:=</span> <span class="n">false</span><span class="p">;</span>
    <span class="n">bPurgeDone</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">VVC_80</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
    <span class="n">VVC_81</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
    <span class="n">VVC_82</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
    <span class="n">VVC_83</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
    <span class="n">VVC_84</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
    <span class="n">VVC_85</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
    <span class="n">VVC_86</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
    <span class="n">VCN_40</span><span class="o">.</span><span class="n">M_ValveControl</span><span class="p">(</span><span class="n">E_VCN</span><span class="o">.</span><span class="n">CloseValve</span><span class="p">);</span>
    <span class="n">VGP_40</span><span class="o">.</span><span class="n">M_ValveControl</span><span class="p">(</span><span class="n">E_VCN</span><span class="o">.</span><span class="n">ManualControl</span><span class="p">);</span> <span class="o">//</span> <span class="n">CLOSE</span> <span class="ow">or</span> <span class="n">OPEN</span> <span class="n">to</span> <span class="n">pump</span> <span class="n">down</span>
    <span class="n">sMessage</span><span class="o">:=</span> <span class="s1">&#39;Purge Error: Interlock&#39;</span><span class="p">;</span>
<span class="n">END_CASE</span>


<span class="o">//</span><span class="n">shouldn</span><span class="s1">&#39;t be here</span>
<span class="p">(</span><span class="o">*</span>
<span class="k">if</span> <span class="p">(</span><span class="n">bPurgeActive</span><span class="p">)</span> <span class="n">then</span>
    <span class="n">VVC_83</span><span class="o">.</span><span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="n">VVC_84</span><span class="o">.</span><span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="n">VVC_85</span><span class="o">.</span><span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="n">VVC_86</span><span class="o">.</span><span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="n">false</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="o">*</span><span class="p">)</span>

<span class="o">//</span><span class="n">Errors</span>
<span class="k">if</span> <span class="p">(</span><span class="n">step</span> <span class="o">&gt;</span><span class="mi">900</span> <span class="p">)</span> <span class="n">Then</span>
    <span class="o">//</span><span class="n">Error</span>
    <span class="n">bStartPurge_sw</span> <span class="o">:=</span> <span class="n">false</span><span class="p">;</span>
    <span class="n">bPurgeActive</span> <span class="o">:=</span> <span class="n">false</span><span class="p">;</span>
    <span class="n">bPurgeDone</span> <span class="o">:=</span> <span class="n">false</span><span class="p">;</span>
    <span class="n">bError</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">VVC_80</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
    <span class="n">VVC_81</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
    <span class="n">VVC_82</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
    <span class="n">VVC_83</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
    <span class="n">VVC_84</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
    <span class="n">VVC_85</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
    <span class="n">VVC_86</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
    <span class="n">VCN_40</span><span class="o">.</span><span class="n">M_ValveControl</span><span class="p">(</span><span class="n">E_VCN</span><span class="o">.</span><span class="n">CloseValve</span><span class="p">);</span>
    <span class="n">VGP_40</span><span class="o">.</span><span class="n">M_ValveControl</span><span class="p">(</span><span class="n">E_VCN</span><span class="o">.</span><span class="n">ManualControl</span><span class="p">);</span>
    <span class="n">sMessage</span><span class="o">:=</span> <span class="n">CONCAT</span><span class="p">(</span><span class="s1">&#39;Purge Error: &#39;</span><span class="p">,</span><span class="n">TO_STRING</span><span class="p">(</span><span class="n">step</span><span class="p">));</span>
<span class="n">END_IF</span>

<span class="n">rt_reset</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span> <span class="n">bReset</span><span class="p">);</span>
<span class="n">IF</span> <span class="n">rt_reset</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span> <span class="n">Step</span><span class="o">:=</span><span class="mi">100</span><span class="p">;</span> <span class="n">bReset</span><span class="o">:=</span><span class="kc">False</span><span class="p">;</span> <span class="n">bPurgeDone</span><span class="o">:=</span><span class="kc">False</span><span class="p">;</span> <span class="n">END_IF</span>

<span class="o">//</span><span class="n">Timers</span>
<span class="n">VVC_81_Timer</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span> <span class="p">(</span><span class="n">step</span> <span class="o">=</span> <span class="mi">50</span><span class="p">),</span> <span class="n">PT</span><span class="o">:=</span><span class="n">VVC_81_Time</span><span class="p">);</span>
<span class="n">VVC_82_Timer</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span> <span class="p">(</span><span class="n">step</span> <span class="o">=</span> <span class="mi">41</span><span class="p">),</span> <span class="n">PT</span><span class="o">:=</span><span class="n">VVC_82_Time</span><span class="p">);</span>
<span class="n">VCN_Timer</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span> <span class="p">(</span><span class="n">step</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span> <span class="n">OR</span> <span class="p">(</span><span class="n">step</span> <span class="o">=</span> <span class="mi">61</span><span class="p">)</span>  <span class="n">OR</span> <span class="p">(</span><span class="n">step</span> <span class="o">=</span> <span class="mi">63</span><span class="p">)</span>  <span class="n">OR</span> <span class="p">(</span><span class="n">step</span> <span class="o">=</span> <span class="mi">65</span><span class="p">)</span>  <span class="n">OR</span> <span class="p">(</span><span class="n">step</span> <span class="o">=</span> <span class="mi">67</span><span class="p">)</span> <span class="n">OR</span> <span class="p">(</span><span class="n">step</span> <span class="o">=</span> <span class="mi">70</span><span class="p">),</span> <span class="n">PT</span><span class="o">:=</span><span class="n">VCN_Time</span><span class="p">);</span>
<span class="n">NeedleVlvPurgeTmr</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span> <span class="p">(</span><span class="n">step</span> <span class="o">=</span> <span class="mi">60</span><span class="p">)</span> <span class="n">OR</span> <span class="p">(</span><span class="n">step</span> <span class="o">=</span> <span class="mi">62</span><span class="p">)</span>  <span class="n">OR</span> <span class="p">(</span><span class="n">step</span> <span class="o">=</span> <span class="mi">64</span><span class="p">)</span>  <span class="n">OR</span> <span class="p">(</span><span class="n">step</span> <span class="o">=</span> <span class="mi">66</span><span class="p">)</span>  <span class="n">OR</span> <span class="p">(</span><span class="n">step</span> <span class="o">=</span> <span class="mi">68</span><span class="p">),</span> <span class="n">PT</span><span class="o">:=</span><span class="n">NeedlePurgeTime</span> <span class="p">);</span>

<span class="o">//</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">bStartPurge_sw</span><span class="p">)</span> <span class="n">THEN</span> <span class="n">bGo</span> <span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span> <span class="n">END_IF</span>
<span class="o">///</span> <span class="n">If</span> <span class="n">at</span> <span class="nb">any</span> <span class="n">point</span> <span class="n">the</span> <span class="n">VGP</span> <span class="n">interlocked</span> <span class="ow">or</span> <span class="ow">in</span> <span class="n">an</span> <span class="n">error</span> <span class="n">state</span><span class="p">,</span> <span class="n">we</span> <span class="n">stop</span> <span class="n">purge</span><span class="o">.</span>

<span class="n">IF</span> <span class="p">((</span><span class="n">VGP_40</span><span class="o">.</span><span class="n">q_stVGP</span><span class="o">.</span><span class="n">pv_xError</span> <span class="p">)</span> <span class="n">OR</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">VGP_40</span><span class="o">.</span><span class="n">i_xExtIlkOK</span><span class="p">))</span> <span class="n">AND</span> <span class="p">(</span><span class="n">bPurgeActive</span><span class="p">)</span>  <span class="n">AND</span> <span class="p">(</span><span class="n">step</span> <span class="o">&gt;=</span><span class="mi">55</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">step</span> <span class="o">&lt;=</span><span class="mi">70</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">900</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">IF</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">VCN_40</span><span class="o">.</span><span class="n">i_xExtIlkOK</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">bPurgeActive</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">step</span> <span class="o">&gt;=</span><span class="mi">60</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">step</span> <span class="o">&lt;=</span><span class="mi">70</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">900</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">NOT</span> <span class="p">(</span><span class="n">fb_EM1K0_GMD_PRT_40</span><span class="o">.</span><span class="n">stPump</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">E_PumpState</span><span class="o">.</span><span class="n">pumpRUNNING</span><span class="p">))</span> <span class="n">AND</span> <span class="p">(</span><span class="n">bPurgeActive</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">step</span><span class="o">:=</span><span class="mi">900</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
</div>
<div class="section" id="prg-vac-intf">
<h2>PRG_VAC_INTF<a class="headerlink" href="#prg-vac-intf" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_VAC_INTF</span>
<span class="n">VAR</span>
<span class="n">END_VAR</span>
<span class="n">ads_watch_dog</span><span class="p">(</span>
    <span class="n">sNetId</span> <span class="o">:=</span> <span class="s1">&#39;172.21.92.61.1.1&#39;</span><span class="p">,</span> <span class="o">//</span> <span class="n">AMS</span> <span class="n">NET</span> <span class="n">ID</span> <span class="n">of</span> <span class="n">the</span> <span class="n">PLC</span> <span class="n">reading</span> <span class="kn">from</span> <span class="nn">this</span> <span class="n">PLC</span> <span class="p">(</span><span class="n">SXR</span> <span class="n">Vacuum</span><span class="p">)</span>
    <span class="n">nPort</span> <span class="o">:=</span> <span class="mi">851</span><span class="p">,</span> <span class="o">//</span> <span class="n">ADS</span> <span class="n">port</span> <span class="n">of</span> <span class="n">the</span> <span class="n">PLC</span> <span class="n">reading</span> <span class="kn">from</span> <span class="nn">this</span> <span class="n">PLC</span>
    <span class="n">sVarName</span> <span class="o">:=</span> <span class="s1">&#39;GVL_VAC_INTF.n_EM1K0_VAC_counter&#39;</span><span class="p">,</span> <span class="o">//</span> <span class="n">Full</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">UDINT</span> <span class="n">provided</span> <span class="n">to</span> <span class="n">the</span> <span class="s1">&#39;iWatchdog&#39;</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">interface</span> <span class="n">functions</span> <span class="n">on</span> <span class="n">the</span> <span class="n">PLC</span> <span class="n">reading</span> <span class="kn">from</span> <span class="nn">this</span> <span class="n">PLC</span>
<span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
</div>
<div class="section" id="prg-vgp">
<h2>PRG_VGP<a class="headerlink" href="#prg-vgp" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_VGP</span>
<span class="n">VAR</span>
    <span class="n">arrTable</span>                                                                                        <span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1.</span><span class="o">.</span><span class="mi">14</span><span class="p">,</span><span class="mf">1.</span><span class="o">.</span><span class="mi">2</span><span class="p">]</span> <span class="n">OF</span> <span class="n">FLOAT</span><span class="p">;</span>
    <span class="n">arrTable_ENC</span>                                                                            <span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1.</span><span class="o">.</span><span class="mi">14</span><span class="p">,</span><span class="mf">1.</span><span class="o">.</span><span class="mi">2</span><span class="p">]</span> <span class="n">OF</span> <span class="n">FLOAT</span><span class="p">;</span>

    <span class="n">bInit</span><span class="p">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="n">true</span><span class="p">;</span>

    <span class="n">VGP_REQ_POS</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">VGP_OUT_POS</span><span class="p">:</span><span class="n">LREAL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">bInit</span>
<span class="n">THEN</span>


    <span class="p">(</span><span class="o">*</span> <span class="n">init</span> <span class="n">array</span> <span class="k">with</span> <span class="n">the</span> <span class="n">interpolation</span> <span class="n">points</span>  <span class="o">*</span><span class="p">)</span>
    <span class="p">(</span><span class="o">*</span>      <span class="n">fIn</span>                                      <span class="o">|</span>              <span class="n">fOut</span>            <span class="o">*</span><span class="p">)</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>                     <span class="n">arrTable</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">5</span><span class="p">;</span>                 <span class="n">arrTable</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">135</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">10</span><span class="p">;</span>            <span class="n">arrTable</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">245</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span>  <span class="mi">20</span><span class="p">;</span>       <span class="n">arrTable</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">405</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span>  <span class="mi">30</span><span class="p">;</span>       <span class="n">arrTable</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">535</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">40</span><span class="p">;</span>            <span class="n">arrTable</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">689</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">50</span><span class="p">;</span>            <span class="n">arrTable</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">830</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">60</span><span class="p">;</span>        <span class="n">arrTable</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">960</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">70</span><span class="p">;</span>        <span class="n">arrTable</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">1095</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">80</span><span class="p">;</span>           <span class="n">arrTable</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">1225</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">90</span><span class="p">;</span>           <span class="n">arrTable</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">1415</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">95</span><span class="p">;</span>           <span class="n">arrTable</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">1495</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">13</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">98</span><span class="p">;</span>           <span class="n">arrTable</span><span class="p">[</span><span class="mi">13</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">1559</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">100</span><span class="p">;</span>          <span class="n">arrTable</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">1645</span><span class="p">;</span>


    <span class="p">(</span><span class="o">*</span> <span class="n">reset</span> <span class="n">the</span> <span class="n">init</span> <span class="n">flag</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">bInit</span>                                                   <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">VGP_40</span><span class="o">.</span><span class="n">i_xOpenIlkOK</span> <span class="o">:=</span> <span class="p">(</span><span class="n">fb_EM1K0_GMD_PTM_40</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span><span class="p">)</span> <span class="p">;</span>
<span class="n">VGP_40</span><span class="p">(</span>
    <span class="n">i_xExtIlkOK</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span><span class="o">//</span><span class="p">(</span><span class="n">fb_EM1K0_GMD_PTM_40</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span><span class="p">),</span>
    <span class="n">i_ReqPos</span><span class="o">:=</span> <span class="p">,</span>
    <span class="n">arrTable</span><span class="o">:=</span> <span class="n">arrTable</span> <span class="p">,</span>
    <span class="n">q_stVGP</span><span class="o">=&gt;</span> <span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="plc-kfe-gmd-vac_plc_kfe_gmd_vac_sim_summary.html" class="btn btn-neutral float-right" title="Settings" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="plc-kfe-gmd-vac_plc_kfe_gmd_vac_epics.html" class="btn btn-neutral float-left" title="Data Types" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, SLAC National Accelerator Laboratory.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>